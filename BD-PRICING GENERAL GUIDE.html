<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BD Pricing Decision Guide</title>
<style>
:root{
  --bg:#f4f7fb;
  --card:#ffffff;
  --muted:#64748b;
  --accent:#4d148c;
  --accent-2:#ff6600;
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  color:#0f172a;
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,var(--bg),#eef6ff);display:flex;flex-direction:column;min-height:100vh;}
header, footer{background:var(--accent);color:white;padding:16px 28px;}
header h1, footer p{margin:0;font-weight:600;}
.container{max-width:1400px;margin:0 auto;display:grid;grid-template-columns:1fr 1fr 420px;gap:20px;align-items:start;padding:28px 0;flex:1}
.card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 8px 28px rgba(2,6,23,0.06);overflow:hidden}
h1{margin:0;font-size:22px;color:var(--accent)}
p.lead{margin:6px 0 14px;color:var(--muted);font-size:13px}
.progress-container{display:flex;align-items:center;gap:10px;margin:14px 0}
.progress-bar{flex:1;height:10px;background:#e2e8f0;border-radius:999px;overflow:hidden}
.progress-fill{height:100%;width:0%;background:var(--accent);transition:width .3s}
.progress-text{font-size:13px;color:var(--muted)}
.node{padding:12px;border-radius:10px;border:1px solid rgba(3,7,18,0.05);background:linear-gradient(180deg,#ffffff,#fbfeff);margin:10px 0;min-height:64px}
.choice-list{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
.choice{padding:8px 12px;border-radius:999px;background:#eef8f7;border:1px solid rgba(4,20,20,0.03);cursor:pointer;font-weight:600}
.choice:hover{background:#e0f2fe}
.choice.active{background:var(--accent);color:white}
.path{margin-top:12px;padding:10px;border-radius:10px;background:#f8fafc;border:1px dashed rgba(3,7,18,0.04);font-size:13px}
.path strong{color:var(--accent)}
.result{margin-top:12px;padding:12px;border-radius:10px;background:#e6fbfb;border-left:4px solid var(--accent-2);animation:fadeIn 0.4s ease-in;min-height:56px}
.note{margin-top:6px;font-size:13px;color:var(--muted);font-style:italic}
.controls{display:flex;gap:8px;margin-top:12px}
button{background:var(--accent);color:white;border:none;padding:9px 12px;border-radius:9px;cursor:pointer;font-weight:600}
button.secondary{background:#fff;color:var(--accent);border:1px solid #ccc}
.output-card{margin-top:16px;padding:14px;border-radius:10px;background:#ffffff;box-shadow:0 4px 12px rgba(0,0,0,0.05);animation:fadeIn 0.45s ease-in;position:relative}
.output-header{font-weight:700;color:var(--accent);margin-bottom:8px ;color:#000 !important;display:flex;justify-content:space-between;align-items:center;}
.output-box{
  padding:10px;
  border-left:4px solid var(--accent-2);
  background:#f8fafc;
  border-radius:8px;
  white-space:pre-wrap;
   font-size:11px; 
}
.copy-btn{background:var(--accent);color:white;border:none;padding:6px 10px;margin-top:10px;border-radius:6px;cursor:pointer;font-size:13px}
.copy-btn:hover{opacity:.85}
.extra-note{margin-top:8px;font-size:13px;color:var(--muted);font-style:italic}
.edit-icon{cursor:pointer;font-size:16px;color:var(--accent);margin-left:8px}
.edit-icon:hover{text-decoration:underline}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:1000}
.modal-content{background:white;padding:20px;border-radius:10px;min-width:300px;text-align:center}
textarea{resize:none}
@keyframes fadeIn {from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
@media(max-width:1200px){.container{grid-template-columns:1fr}}
/* MODAL STYLES */
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.45); align-items: center; justify-content: center; z-index: 1000; animation: fadeIn 0.3s ease;}
.modal-content { background: #fff; padding: 25px 30px; border-radius: 12px; min-width: 500px; max-width: 600px; box-shadow: 0 12px 28px rgba(0,0,0,0.2); text-align: center; font-family: Inter, sans-serif; }
.modal-content h3 { margin-top: 0; margin-bottom: 15px; font-size: 18px; font-weight: 600; color: var(--accent); }
.modal-content input[type="password"], .modal-content textarea { width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid #d1d5db; font-size: 14px; margin-top: 10px; font-family: Inter, sans-serif; }
.modal-content textarea { min-height: 120px; resize: vertical; }
.modal-content button { border: none; padding: 8px 16px; border-radius: 8px; font-weight: 600; font-size: 14px; margin-left: 6px; cursor: pointer; transition: all 0.2s ease; }
.modal-content button:hover { opacity: 0.9; }
.modal-content .save-btn { background-color: var(--accent); color: #fff; }
.modal-content .cancel-btn { background-color: #e5e7eb; color: #111827; }
@media(max-width:500px){ .modal-content { width: 90%; min-width: unset; padding:20px; } }
</style>
</head>
<body>

<header style="display:flex;align-items:center;justify-content:space-between;">
  <div style="display:flex;align-items:center;gap:12px;">
     <img src="fedex.png" alt="FedEx Logo" style="height:40px;">
    <h1>BD Tools ‚Äî Pricing Decision Guide</h1>
  </div>
  <div style="display:flex;gap:8px;">
    <button onclick="window.location.href='index.html'">Main Page</button>
    <button onclick="window.location.href='OVC GENERAL GUIDE.html'">Go to OVC General Guide</button>
  </div>
</header>

<div class="container">
  <div class="card">
    <h1>Pricing Decision Guide</h1>
    <p class="lead">Follow the flow below to determine the recommended pricing action.</p>
    <div class="progress-container">
      <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
      <div id="progressText" class="progress-text">Step 1 of ?</div>
    </div>
    <div id="flowArea" class="node"></div>
    <div class="controls">
      <button id="goBackBtn" class="secondary" style="display:none;">‚Üê Go Back</button>
      <button id="startOverBtn" class="secondary" style="display:none;">Start Over</button>
    </div>
  </div>

  <div class="card">
    <div class="node">
      <strong>Selected Path</strong>
      <div id="selectedPath" class="path">No steps selected yet.</div>
    </div>
    <div class="node">
      <strong>Recommended Action</strong>
      <div id="recommendation" class="result">No recommendation yet.</div>
    </div>
  </div>

  <div class="card" id="suggestedPanel" style="display:none;">
    <div class="output-card" id="commentCard">
      <div class="output-header">
        Suggested Comment
        <span class="edit-icon" onclick="attemptEdit('comment')" title="Do you want to update the Comment?">‚úèÔ∏è</span>
      </div>
      <div id="suggestedComment" class="output-box"></div>
    </div>
    <div class="output-card" id="emailCard">
      <div class="output-header">
        Suggested Email
        <span class="edit-icon" onclick="attemptEdit('email')" title="Do you want to update the Email?">‚úèÔ∏è</span>
      </div>
      <div id="suggestedEmail" class="output-box"></div>
      <button class="copy-btn" id="copyEmailBtn">üìã Copy</button>
    </div>
    <div id="generalNote" class="note">Note: These are suggested templates. Personalized emails or comments are always more appreciated.</div>
  </div>
</div>

<!-- Password Modal -->
<div id="passwordModal" class="modal">
  <div class="modal-content">
    <h3>Enter Password to Edit</h3>
    <input type="password" id="adminPassword" placeholder="Password">
    <div style="margin-top:18px;">
      <button class="save-btn" onclick="checkPassword()">Submit</button>
      <button class="cancel-btn" onclick="closePasswordModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <h3 id="modalTitle">Edit</h3>
    <div id="modalHint" class="note" style="margin-bottom:6px;"></div>
    <textarea id="editTextarea"></textarea>
    <div style="margin-top:18px;text-align:right;">
      <button class="save-btn" onclick="saveEdit()">Save</button>
      <button class="cancel-btn" onclick="closeEditModal()">Cancel</button>
    </div>
  </div>
</div>

<footer style="display:flex;align-items:center;justify-content:space-between;">
  <p>¬© 2025 EBS Operations</p>
  <div style="display:flex;align-items:center;gap:10px;">
    <span style="font-size:12px;color:white;">
      "Your feedback is important to us. Please feel free to email us with any comments or questions." -Jules
    </span>
  </div>
</footer>

<!-- ---------- MAIN DECISION TREE + UI LOGIC ---------- -->
<script>
/* ---------- DECISION TREE ---------- */
/* (kept the same structure you provided earlier) */
const TREE = {
  id: "root",
  text: "Does the customer have a surcharge exception?",
  choices: [
    { label: "Yes", next: "yes_exception" },
    { label: "No", next: "no_exception" }
  ]
};

const NODES = {
  yes_exception: {
    text: "Yes ‚Äî which case?",
    choices: [
      { label: "Yes, but does not apply on PRO after autorating", next: "no_apply_after_auto" },
      { label: "Yes, has surcharge exception effective at the time of shipment", next: "yes_apply_effective" }
    ]
  },
  no_apply_after_auto: {
    text: "Run a quote to verify whether their pricing is already fixed.",
    choices: [
      { label: "Rate quote does NOT pull correct pricing", next: "quote_not_correct" },
      { label: "Rate quote pulls correct pricing", next: "quote_correct" }
    ]
  },
  quote_not_correct: { text: "Verify whether eRPT is needed by following the eRPT guideline.", choices: [] },
  quote_correct: { text: "Email Training Team for approval to manually rate the invoice.", choices: [] },

  yes_apply_effective: {
    text: "Read carefully and understand the exception. Can it be applied on PRO?",
    choices: [
      { label: "Surcharge is manually rated accessorial (Storage/Detention)", next: "manually_rated" },
      { label: "Surcharge is NOT manually rated", next: "not_manually_rated" }
    ]
  },
  manually_rated: { text: "Manually apply the customer's accessorial exception on PRO.", choices: [] },
  not_manually_rated: { text: "Verify whether eRPT is needed by following the eRPT guideline.", choices: [] },

  no_exception: {
    text: "Which situation?",
    choices: [
      { label: "No previous exception, but customer published agreement later", next: "published_agreement" },
      { label: "Does the customer have exception BEFORE and AFTER shipment?", next: "before_after_question" }
    ]
  },
  published_agreement: {
    text: "Effective date of the agreement?",
    choices: [
      { label: "More than 180 days from ship date", next: "published_more" },
      { label: "Within 180 days from ship date", next: "published_within" }
    ]
  },
  published_more: { text: "Inform the customer appropriately regarding their pricing details.", choices: [] },
  published_within: { text: "Apply the pricing exception.", choices: [] },

  before_after_question: {
    text: "Does the customer have a surcharge exception before and after the shipment?",
    choices: [
      { label: "Yes", next: "yes_before_after" },
      { label: "No", next: "no_before_after" }
    ]
  },
  yes_before_after: {
    text: "Verify if the customer has a pricing gap.",
    choices: [
      { label: "Gap less than 2 weeks (‚â§14 days)", next: "gap_less" },
      { label: "Gap more than 2 weeks (‚â•15 days)", next: "gap_more" }
    ]
  },
  gap_less: { text: "If we aren‚Äôt overriding a previous agreement or anything like that and all we are doing is applying the customer‚Äôs pricing, simply due to nothing more than a gap which was 2 weeks or less, go ahead and rerate without asking for approval.", choices: [] },

  gap_more: {
    text: "Who are you talking to?",
    choices: [
      { label: "Customer", next: "gap_customer" },
      { label: "Sales Rep", next: "gap_salesrep" }
    ]
  },
  gap_customer: { text: "Send an email to the Training Team, who will forward the case to Dustin Carlton. Dustin will then reach out to the Sales Rep who will be sending a Rerate Request.", choices: [] },
  gap_salesrep: { text: "Advise the Sales Rep to fill out a Back Date Form and send a Rerate request.", choices: [] },
  no_before_after: { text: "Inform the customer appropriately regarding their pricing details.", choices: [] }
};

/* ---------- STATE ---------- */
let path = [];
let historyStack = [];
let currentFinalRecommendation = "";
let currentEditType = "";

/* retry counters map for loading from firestore if not ready yet */
const _firestoreLoadAttempts = {};

/* ---------- HELPERS ---------- */
function escapeHtml(unsafe) { 
  if (unsafe === null || unsafe === undefined) return "";
  return String(unsafe).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
}

/* ---------- RENDER ---------- */
function renderNode(nodeObj,nodeKey="root") {
  const flowArea=document.getElementById("flowArea");
  const goBackBtn=document.getElementById("goBackBtn");
  const startOverBtn=document.getElementById("startOverBtn");
  const progressFill=document.getElementById("progressFill");
  const progressText=document.getElementById("progressText");
  const suggestedPanel=document.getElementById("suggestedPanel");

  flowArea.innerHTML="";
  document.getElementById("recommendation").innerHTML="No recommendation yet.";
  document.getElementById("suggestedComment").innerHTML="";
  document.getElementById("suggestedEmail").textContent="";
  suggestedPanel.style.display="none";

  if(nodeObj && nodeObj.text && nodeObj.choices && nodeObj.choices.length){
    const q=document.createElement("div"); q.innerHTML=`<strong style="font-size:16px">${escapeHtml(nodeObj.text)}</strong>`; flowArea.appendChild(q);
    const list=document.createElement("div"); list.className="choice-list";
    nodeObj.choices.forEach(choice=>{
      const btn=document.createElement("div"); btn.className="choice"; btn.textContent=choice.label;
      btn.onclick=()=>{
        historyStack.push({nodeKey, path: JSON.parse(JSON.stringify(path))});
        path.push({question:nodeObj.text,answer:choice.label});
        const nextNode = NODES[choice.next] || (choice.action?{action:choice.action,note:choice.note}: {});
        if(nextNode.action) currentFinalRecommendation = nextNode.action;
        renderNode(nextNode,choice.next);
        updateSelectedPath();
        if(nextNode.action) generateSuggestedCommentEmail(nextNode.action);
      }; 
      list.appendChild(btn);
    }); flowArea.appendChild(list);
  } else if(nodeObj && nodeObj.text){
    // final-action node
    const actionText = nodeObj.action || nodeObj.text;
    currentFinalRecommendation = actionText;
    document.getElementById("recommendation").innerHTML = `<strong>${escapeHtml(actionText)}</strong>${nodeObj.note?`<div class="note">${escapeHtml(nodeObj.note)}</div>`:''}`;
    updateSelectedPath();
    generateSuggestedCommentEmail(actionText);
  }

  goBackBtn.style.display = historyStack.length ? "inline-block" : "none";
  startOverBtn.style.display = path.length ? "inline-block" : "none";

  const stepNum = Math.max(1, path.length + (currentFinalRecommendation ? 1 : 0));
  progressFill.style.width = Math.min(stepNum * 20, 100) + "%";
  progressText.textContent = `Step ${Math.min(stepNum, 99)}`;
}

/* ---------- PATH DISPLAY ---------- */
function updateSelectedPath(){
  const el=document.getElementById("selectedPath");
  if(!path.length){ el.innerHTML = "No steps selected yet."; return; }
  el.innerHTML = path.map((p,idx)=>`<strong>Step ${idx+1}:</strong> ${escapeHtml(p.question)} ‚Üí <strong><em>${escapeHtml(p.answer)}</em></strong>`).join("<br>");
}

/* ---------- SUGGESTED COMMENT & EMAIL ---------- */
/* This function attempts to load saved templates from Firestore.
   If Firestore module isn't ready yet (load function not attached), it will retry a few times then fallback to defaults.
*/
function generateSuggestedCommentEmail(finalText) {
  const commentBox = document.getElementById("suggestedComment");
  const emailBox = document.getElementById("suggestedEmail");
  const suggestedPanel = document.getElementById("suggestedPanel");

  if (!finalText) {
    suggestedPanel.style.display = "none";
    commentBox.innerHTML = "";
    emailBox.innerHTML = "";
    return;
  }

  // create a safe document id (encode)
  const docId = encodeURIComponent(finalText);

  // if loadFromFirestore is available, use it
  if (typeof window.loadFromFirestore === "function") {
    // reset attempts counter for this finalText
    _firestoreLoadAttempts[docId] = 0;
    window.loadFromFirestore(docId).then(data => {
      const comment = (data && data.comment) ? data.comment : `VS-BLER-CASE#-${finalText}`;
      const email = (data && data.email) ? data.email : `Hi,\n\n${finalText}\n\nThank you,\nEBS Operations - Invoicing Solutions`;
      // keep HTML formatting for email box (allow <br> if any)
      commentBox.innerHTML = comment;
      // show as preformatted text in output box while preserving line breaks:
      emailBox.innerHTML = email.replace(/\n/g,"<br>");
      suggestedPanel.style.display = "block";
    }).catch(err => {
      console.error("Error loading from Firestore:", err);
      // fallback to defaults if load fails
      commentBox.innerHTML = `VS-BLER-CASE#-${finalText}`;
      emailBox.innerHTML = `Hi,<br><br>${escapeHtml(finalText)}<br><br>Thank you,<br>EBS Operations - Invoicing Solutions`;
      suggestedPanel.style.display = "block";
    });
  } else {
    // Firestore not ready yet ‚Äî retry a few times then fallback
    const maxAttempts = 10;
    _firestoreLoadAttempts[docId] = (_firestoreLoadAttempts[docId] || 0) + 1;
    if (_firestoreLoadAttempts[docId] <= maxAttempts) {
      // try again shortly
      setTimeout(() => generateSuggestedCommentEmail(finalText), 200);
      return;
    } else {
      // fallback to defaults
      commentBox.innerHTML = `VS-BLER-CASE#-${finalText}`;
      emailBox.innerHTML = `Hi,<br><br>${escapeHtml(finalText)}<br><br>Thank you,<br>EBS Operations - Invoicing Solutions`;
      suggestedPanel.style.display = "block";
      return;
    }
  }
}

/* ---------- ADMIN EDIT ---------- */
function attemptEdit(type){
  currentEditType = type;
  document.getElementById("adminPassword").value = "";
  document.getElementById("passwordModal").style.display = "flex";
}

function closePasswordModal() { document.getElementById("passwordModal").style.display = "none"; }

function checkPassword() {
  if (document.getElementById("adminPassword").value === "admin") {
    closePasswordModal();
    openEditModal();
  } else {
    alert("Incorrect password!");
  }
}

function openEditModal() {
  if (!currentFinalRecommendation) {
    alert("Select a recommendation first before editing.");
    return;
  }
  const currentBox = currentEditType === "comment" ? document.getElementById("suggestedComment") : document.getElementById("suggestedEmail");
  // read innerHTML so we can preserve line breaks for email
  const currentContent = currentBox ? currentBox.innerHTML : "";
  // convert <br> back to newlines for textarea
  document.getElementById("editTextarea").value = currentContent.replace(/<br\s*\/?>/g,"\n");
  document.getElementById("modalTitle").textContent = `Edit ${currentEditType === "comment" ? "Comment" : "Email"}`;
  document.getElementById("modalHint").textContent = "Edits will be saved to Firestore for this exact recommendation text.";
  document.getElementById("editModal").style.display = "flex";
}

function closeEditModal() { document.getElementById("editModal").style.display = "none"; }

function saveEdit() {
  const val = document.getElementById("editTextarea").value;
  if (!currentFinalRecommendation) {
    alert("No recommendation selected to save edits for!");
    return;
  }
  const docId = encodeURIComponent(currentFinalRecommendation);

  // Firestore helpers must be available (exposed by module)
  if (typeof window.saveCommentToFirestore !== "function" || typeof window.saveEmailToFirestore !== "function") {
    alert("Saving is not ready yet ‚Äî please try again in a moment.");
    closeEditModal();
    return;
  }

  if (currentEditType === "comment") {
    window.saveCommentToFirestore(docId, val)
      .then(() => {
        document.getElementById("suggestedComment").innerHTML = val;
        document.getElementById("suggestedPanel").style.display = "block";
        alert("Comment saved to Firestore.");
        closeEditModal();
      })
      .catch(err => {
        console.error("Error saving comment:", err);
        alert("Error saving comment to Firestore. Check console.");
      });
  } else {
    window.saveEmailToFirestore(docId, val)
      .then(() => {
        document.getElementById("suggestedEmail").innerHTML = val.replace(/\n/g,"<br>");
        document.getElementById("suggestedPanel").style.display = "block";
        alert("Email saved to Firestore.");
        closeEditModal();
      })
      .catch(err => {
        console.error("Error saving email:", err);
        alert("Error saving email to Firestore. Check console.");
      });
  }
}

/* ---------- EVENTS ---------- */
document.getElementById("goBackBtn").onclick = () => {
  if (historyStack.length) {
    const last = historyStack.pop();
    path = last.path || [];
    renderNode(NODES[last.nodeKey] || TREE, last.nodeKey);
    updateSelectedPath();
  }
};

document.getElementById("startOverBtn").onclick = () => {
  path = [];
  historyStack = [];
  currentFinalRecommendation = "";
  document.getElementById("selectedPath").textContent = "No steps selected yet.";
  document.getElementById("suggestedPanel").style.display = "none";
  renderNode(TREE, "root");
};

document.getElementById("copyEmailBtn").onclick = () => {
  const txt = (document.getElementById("suggestedEmail").innerText || document.getElementById("suggestedEmail").textContent || "");
  navigator.clipboard.writeText(txt).then(() => {
    alert("Email copied!");
  }).catch(() => {
    alert("Unable to copy - your browser may block clipboard access.");
  });
};

/* ---------- INIT ---------- */
window.addEventListener('load', () => {
  renderNode(TREE, "root");
});
</script>

<!-- ---------- FIREBASE MODULE: placed at bottom as requested (Option A) ---------- -->
<script type="module">
/* Firebase (CDN modular) initialization and Firestore helpers
   Uses two collections:
     - pricing_comments (documents: docId -> { comment: "..."} )
     - pricing_emails   (documents: docId -> { email: "..." } )
*/

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, doc, getDoc, setDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// Your Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDjaMdeh0Cgx00hzDyZOi54fDkR81wnxJU",
  authDomain: "bdgg-database.firebaseapp.com",
  projectId: "bdgg-database",
  storageBucket: "bdgg-database.firebasestorage.app",
  messagingSenderId: "43574975434",
  appId: "1:43574975434:web:4c79e581267fdfcc6ccd33"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Save comment to pricing_comments/{docId}
export async function saveCommentToFirestore(docId, commentText) {
  if (!docId) throw new Error("docId required");
  try {
    await setDoc(doc(db, "pricing_comments", docId), { comment: commentText }, { merge: true });
  } catch (err) {
    console.error("saveCommentToFirestore error:", err);
    throw err;
  }
}

// Save email to pricing_emails/{docId}
export async function saveEmailToFirestore(docId, emailText) {
  if (!docId) throw new Error("docId required");
  try {
    await setDoc(doc(db, "pricing_emails", docId), { email: emailText }, { merge: true });
  } catch (err) {
    console.error("saveEmailToFirestore error:", err);
    throw err;
  }
}

// Load both comment & email (returns { comment, email })
export async function loadFromFirestore(docId) {
  if (!docId) return {};
  try {
    const commentRef = doc(db, "pricing_comments", docId);
    const emailRef = doc(db, "pricing_emails", docId);
    const [commentSnap, emailSnap] = await Promise.all([getDoc(commentRef), getDoc(emailRef)]);
    const data = {};
    if (commentSnap.exists()) data.comment = commentSnap.data().comment;
    if (emailSnap.exists()) data.email = emailSnap.data().email;
    return data;
  } catch (err) {
    console.error("loadFromFirestore error:", err);
    throw err;
  }
}

// Expose helpers to the global window so non-module scripts can call them
window.saveCommentToFirestore = saveCommentToFirestore;
window.saveEmailToFirestore = saveEmailToFirestore;
window.loadFromFirestore = loadFromFirestore;

console.log("Firestore helpers ready (pricing_comments / pricing_emails).");
</script>

</body>
</html>
