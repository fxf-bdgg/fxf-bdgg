<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BD Pricing Decision Guide</title>
<style>
:root{
  --bg:#f4f7fb;
  --card:#ffffff;
  --muted:#64748b;
  --accent:#4d148c;
  --accent-2:#ff6600;
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  color:#0f172a;
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,var(--bg),#eef6ff);display:flex;flex-direction:column;min-height:100vh;}
header, footer{background:var(--accent);color:white;padding:16px 28px;}
header h1, footer p{margin:0;font-weight:600;}
.container{max-width:1400px;margin:0 auto;display:grid;grid-template-columns:1fr 1fr 420px;gap:20px;align-items:start;padding:28px 0;flex:1}
.card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 8px 28px rgba(2,6,23,0.06);overflow:hidden}
h1{margin:0;font-size:22px;color:var(--accent)}
p.lead{margin:6px 0 14px;color:var(--muted);font-size:13px}
.progress-container{display:flex;align-items:center;gap:10px;margin:14px 0}
.progress-bar{flex:1;height:10px;background:#e2e8f0;border-radius:999px;overflow:hidden}
.progress-fill{height:100%;width:0%;background:var(--accent);transition:width .3s}
.progress-text{font-size:13px;color:var(--muted)}
.node{padding:12px;border-radius:10px;border:1px solid rgba(3,7,18,0.05);background:linear-gradient(180deg,#ffffff,#fbfeff);margin:10px 0;min-height:64px}
.choice-list{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
.choice{padding:8px 12px;border-radius:999px;background:#eef8f7;border:1px solid rgba(4,20,20,0.03);cursor:pointer;font-weight:600}
.choice:hover{background:#e0f2fe}
.choice.active{background:var(--accent);color:white}
.path{margin-top:12px;padding:10px;border-radius:10px;background:#f8fafc;border:1px dashed rgba(3,7,18,0.04);font-size:13px}
.path strong{color:var(--accent)}
.result{margin-top:12px;padding:12px;border-radius:10px;background:#e6fbfb;border-left:4px solid var(--accent-2);animation:fadeIn 0.4s ease-in;min-height:56px}
.note{margin-top:6px;font-size:13px;color:var(--muted);font-style:italic}
.controls{display:flex;gap:8px;margin-top:12px}
button{background:var(--accent);color:white;border:none;padding:9px 12px;border-radius:9px;cursor:pointer;font-weight:600}
button.secondary{background:#fff;color:var(--accent);border:1px solid #ccc}
.output-card{margin-top:16px;padding:14px;border-radius:10px;background:#ffffff;box-shadow:0 4px 12px rgba(0,0,0,0.05);animation:fadeIn 0.45s ease-in;position:relative}
.output-header{font-weight:700;color:var(--accent);margin-bottom:8px ;color:#000 !important;display:flex;justify-content:space-between;align-items:center;}
.output-box{
  padding:10px;
  border-left:4px solid var(--accent-2);
  background:#f8fafc;
  border-radius:8px;
  white-space:pre-wrap;
   font-size:11px; 
}
.copy-btn{background:var(--accent);color:white;border:none;padding:6px 10px;margin-top:10px;border-radius:6px;cursor:pointer;font-size:13px}
.copy-btn:hover{opacity:.85}
.extra-note{margin-top:8px;font-size:13px;color:var(--muted);font-style:italic}
.edit-icon{cursor:pointer;font-size:16px;color:var(--accent);margin-left:8px}
.edit-icon:hover{text-decoration:underline}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:1000}
.modal-content{background:white;padding:20px;border-radius:10px;min-width:300px;text-align:center}
textarea{resize:none}
@keyframes fadeIn {from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
@media(max-width:1200px){.container{grid-template-columns:1fr}}
/* MODAL STYLES */
.modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.45); align-items: center; justify-content: center; z-index: 1000; animation: fadeIn 0.3s ease;}
.modal-content { background: #fff; padding: 25px 30px; border-radius: 12px; min-width: 500px; max-width: 600px; box-shadow: 0 12px 28px rgba(0,0,0,0.2); text-align: center; font-family: Inter, sans-serif; }
.modal-content h3 { margin-top: 0; margin-bottom: 15px; font-size: 18px; font-weight: 600; color: var(--accent); }
.modal-content input[type="password"], .modal-content textarea { width: 100%; padding: 10px 12px; border-radius: 8px; border: 1px solid #d1d5db; font-size: 14px; margin-top: 10px; font-family: Inter, sans-serif; }
.modal-content textarea { min-height: 120px; resize: vertical; }
.modal-content button { border: none; padding: 8px 16px; border-radius: 8px; font-weight: 600; font-size: 14px; margin-left: 6px; cursor: pointer; transition: all 0.2s ease; }
.modal-content button:hover { opacity: 0.9; }
.modal-content .save-btn { background-color: var(--accent); color: #fff; }
.modal-content .cancel-btn { background-color: #e5e7eb; color: #111827; }
@media(max-width:500px){ .modal-content { width: 90%; min-width: unset; padding:20px; } }
</style>
</head>
<body>

<header style="display:flex;align-items:center;justify-content:space-between;">
  <div style="display:flex;align-items:center;gap:12px;">
     <img src="fedex.png" alt="FedEx Logo" style="height:40px;">
    <h1>BD Tools ‚Äî Pricing Decision Guide</h1>
  </div>
  <div style="display:flex;gap:8px;">
    <button onclick="window.location.href='index.html'">Main Page</button>
    <button onclick="window.location.href='OVC GENERAL GUIDE.html'">Go to OVC General Guide</button>
  </div>
</header>

<div class="container">
  <div class="card">
    <h1>Pricing Decision Guide</h1>
    <p class="lead">Follow the flow below to determine the recommended pricing action.</p>
    <div class="progress-container">
      <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
      <div id="progressText" class="progress-text">Step 1 of ?</div>
    </div>
    <div id="flowArea" class="node"></div>
    <div class="controls">
      <button id="goBackBtn" class="secondary" style="display:none;">‚Üê Go Back</button>
      <button id="startOverBtn" class="secondary" style="display:none;">Start Over</button>
    </div>
  </div>

  <div class="card">
    <div class="node">
      <strong>Selected Path</strong>
      <div id="selectedPath" class="path">No steps selected yet.</div>
    </div>
    <div class="node">
      <strong>Recommended Action</strong>
      <div id="recommendation" class="result">No recommendation yet.</div>
    </div>
  </div>

  <div class="card" id="suggestedPanel" style="display:none;">
    <div class="output-card" id="commentCard">
      <div class="output-header">
        Suggested Comment
        <span class="edit-icon" onclick="attemptEdit('comment')" title="Do you want to update the Comment?">‚úèÔ∏è</span>
      </div>
      <div id="suggestedComment" class="output-box"></div>
    </div>
    
     <!-- ‚úÖ NEW: CORR CODE -->
    <div class="output-card" id="corrCard">
      <div class="output-header">
        Possible CORR CODE
        <span class="edit-icon" onclick="attemptEdit('corr')">‚úèÔ∏è</span>
      </div>
      <div id="suggestedCorrCode" class="output-box"></div>
    </div>
    
    
    <div class="output-card" id="emailCard">
      <div class="output-header">
        Suggested Email
        <span class="edit-icon" onclick="attemptEdit('email')" title="Do you want to update the Email?">‚úèÔ∏è</span>
      </div>
      <div id="suggestedEmail" class="output-box"></div>
      <button class="copy-btn" id="copyEmailBtn">üìã Copy</button>
    </div>
    <div id="generalNote" class="note">Note: These are suggested templates. Personalized emails or comments are always more appreciated.</div>
  </div>
</div>

<!-- Password Modal -->
<div id="passwordModal" class="modal">
  <div class="modal-content">
    <h3>Enter Password to Edit</h3>
    <input type="password" id="adminPassword" placeholder="Password">
    <div style="margin-top:18px;">
      <button class="save-btn" onclick="checkPassword()">Submit</button>
      <button class="cancel-btn" onclick="closePasswordModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <h3 id="modalTitle">Edit</h3>
    <div id="modalHint" class="note" style="margin-bottom:6px;"></div>
    <textarea id="editTextarea"></textarea>
    <div style="margin-top:18px;text-align:right;">
      <button class="save-btn" onclick="saveEdit()">Save</button>
      <button class="cancel-btn" onclick="closeEditModal()">Cancel</button>
    </div>
  </div>
</div>

<footer style="display:flex;align-items:center;justify-content:space-between;">
  <p>¬© 2025 EBS Operations</p>
  <div style="display:flex;align-items:center;gap:10px;">
    <span style="font-size:12px;color:white;">
      "Your feedback is important to us. Please feel free to email us with any comments or questions." -Jules
    </span>
  </div>
</footer>

<!-- ---------- MAIN DECISION TREE + UI LOGIC ---------- -->
<script>
/* ---------- DECISION TREE ---------- */
/* ================= ROOT ================= */

const TREE = {
  id: "root",
  text: "What type of pricing issue is being reviewed?",
  choices: [
    { label: "Pricing - Fuel", next: "fuel_root" },
    { label: "Pricing - Surcharge", next: "surcharge_root" }
  ]
};

/* ================= NODES ================= */

const NODES = {

  /* =====================================================
     PRICING ‚Äì FUEL
  ===================================================== */

  fuel_root: {
    text: "Does the customer have a pricing exception?",
    choices: [
      { label: "Yes", next: "has_pricing_exception" },
      { label: "No", next: "no_pricing_exception" }
    ]
  },

  has_pricing_exception: {
    text: "Does the customer have their own fuel exception?",
    choices: [
      { label: "Yes", next: "own_fuel_exception" },
      { label: "No, using FXF Fuel scale", next: "fxf_fuel_scale" }
    ]
  },

  own_fuel_exception: {
    text: "Find the customer's fuel exception.",
    choices: [
      { label: "Continue", next: "verify_correct_fuel" }
    ]
  },

  verify_correct_fuel: {
    text: "Verify if the correct fuel is being applied.",
    choices: [
      { label: "Fuel applied correctly", next: "fuel_correct" },
      { label: "Fuel applied incorrectly", next: "fuel_incorrect" }
    ]
  },

  fuel_correct: {
    text: "Advise the customer accordingly regarding their fuel exception.",
    choices: []
  },

  fuel_incorrect: {
    text: "Verify whether eRPT is required by following the eRPT guideline.",
    choices: []
  },

  fxf_fuel_scale: {
    text: "Apply fuel using FXF Fuel scale by referencing FXF Rules Item 570.",
    choices: []
  },

  no_pricing_exception: {
    text: "Which situation applies?",
    choices: [
      {
        label: "No previous exception, but customer later published an agreement with FedEx",
        next: "published_later"
      },
      {
        label: "Customer has surcharge exception before and after shipment",
        next: "before_after_surcharge"
      }
    ]
  },

  published_later: {
    text: "Effective date of the agreement?",
    choices: [
      {
        label: "More than 180 days from ship date",
        next: "published_more_180"
      },
      {
        label: "Within 180 days from ship date",
        next: "published_within_180"
      }
    ]
  },

  published_more_180: {
    text: "Inform the customer that the agreement is outside the 180-day window and pricing cannot be applied.",
    choices: []
  },

  published_within_180: {
    text: "Apply the pricing exception.",
    choices: []
  },

  before_after_surcharge: {
    text: "Is there a pricing gap between the surcharge exceptions?",
    choices: [
      { label: "Yes", next: "verify_pricing_gap" },
      { label: "No", next: "inform_pricing_details" }
    ]
  },

  verify_pricing_gap: {
    text: "How long is the pricing gap?",
    choices: [
      { label: "14 days or less", next: "gap_14_or_less" },
      { label: "15 days or more", next: "gap_15_or_more" }
    ]
  },

  gap_14_or_less: {
    text: "Rerate the invoice without requesting approval as the pricing gap is 14 days or less and no agreement is being overridden.",
    choices: []
  },

  gap_15_or_more: {
    text: "Who are you communicating with?",
    choices: [
      { label: "Customer", next: "gap_customer" },
      { label: "Sales Representative", next: "gap_sales_rep" }
    ]
  },

  gap_customer: {
    text: "Send an email to the Training Team, who will forward the case to Dustin Carlton. The Sales Representative will submit a Rerate Request.",
    choices: []
  },

  gap_sales_rep: {
    text: "Advise the Sales Representative to complete a Back Date Form and submit a Rerate Request.",
    choices: []
  },

  inform_pricing_details: {
    text: "Inform the customer appropriately regarding their pricing details.",
    choices: []
  },

  /* =====================================================
     PRICING ‚Äì SURCHARGE
  ===================================================== */

  surcharge_root: {
    text: "Does the customer have a surcharge exception?",
    choices: [
      { label: "Yes", next: "surcharge_yes" },
      { label: "No", next: "surcharge_no" }
    ]
  },

  surcharge_yes: {
    text: "Which situation applies?",
    choices: [
      {
        label: "Yes, but does not apply on PRO after autorating",
        next: "surcharge_not_applied_after_autorate"
      },
      {
        label: "Yes, has surcharge exception effective at time of shipment",
        next: "surcharge_effective_at_shipment"
      }
    ]
  },

  surcharge_not_applied_after_autorate: {
    text: "Run a quote to verify whether the pricing is already fixed.",
    choices: [
      {
        label: "Rate quote does NOT pull correct pricing",
        next: "surcharge_quote_incorrect"
      },
      {
        label: "Rate quote pulls correct pricing",
        next: "surcharge_quote_correct"
      }
    ]
  },

  surcharge_quote_incorrect: {
    text: "Verify whether eRPT is required by following the eRPT guideline.",
    choices: []
  },

  surcharge_quote_correct: {
    text: "Send an email to the Training Team for approval to manually rate the invoice.",
    choices: []
  },

  surcharge_effective_at_shipment: {
    text: "Carefully review the surcharge exception to determine if it can be applied on the PRO.",
    choices: [
      {
        label: "Manually rated accessorial (e.g. Storage, Detention)",
        next: "surcharge_manual_accessorial"
      },
      {
        label: "Not a manually rated accessorial",
        next: "surcharge_not_manual_accessorial"
      }
    ]
  },

  surcharge_manual_accessorial: {
    text: "Manually apply the customer's accessorial surcharge exception on the PRO.",
    choices: []
  },

  surcharge_not_manual_accessorial: {
    text: "Verify whether eRPT is required by following the eRPT guideline.",
    choices: []
  },

  surcharge_no: {
    text: "Which situation applies?",
    choices: [
      {
        label: "No previous exception, but customer later published an agreement with FedEx",
        next: "surcharge_published_later"
      },
      {
        label: "Customer has surcharge exception before and after shipment",
        next: "surcharge_before_after"
      }
    ]
  },

  surcharge_published_later: {
    text: "Effective date of the agreement?",
    choices: [
      {
        label: "More than 180 days from ship date",
        next: "surcharge_more_180"
      },
      {
        label: "Within 180 days from ship date",
        next: "surcharge_within_180"
      }
    ]
  },

  surcharge_more_180: {
    text: "Inform the customer that the agreement is outside the 180-day window and pricing cannot be applied.",
    choices: []
  },

  surcharge_within_180: {
    text: "Apply the surcharge pricing exception.",
    choices: []
  },

  surcharge_before_after: {
    text: "Is there a pricing gap between the surcharge exceptions?",
    choices: [
      { label: "Yes", next: "surcharge_gap_yes" },
      { label: "No", next: "surcharge_gap_no" }
    ]
  },

  surcharge_gap_yes: {
    text: "How long is the pricing gap?",
    choices: [
      { label: "14 days or less", next: "surcharge_gap_14_or_less" },
      { label: "15 days or more", next: "surcharge_gap_15_or_more" }
    ]
  },

  surcharge_gap_14_or_less: {
    text: "Rerate the invoice without requesting approval as the pricing gap is 14 days or less.",
    choices: []
  },

  surcharge_gap_15_or_more: {
    text: "Who are you communicating with?",
    choices: [
      { label: "Customer", next: "surcharge_gap_customer" },
      { label: "Sales Representative", next: "surcharge_gap_sales_rep" }
    ]
  },

  surcharge_gap_customer: {
    text: "Send an email to the Training Team, who will forward the case to Dustin Carlton. The Sales Representative will submit a Rerate Request.",
    choices: []
  },

  surcharge_gap_sales_rep: {
    text: "Advise the Sales Representative to complete a Back Date Form and submit a Rerate Request.",
    choices: []
  },

  surcharge_gap_no: {
    text: "Inform the customer appropriately regarding their pricing details.",
    choices: []
  }

};



/* ---------- STATE ---------- */
let path = [];
let historyStack = [];
let currentFinalRecommendation = "";
let currentEditType = "";
const _firestoreLoadAttempts = {};

function updateProgress(){
  const progressFill = document.getElementById("progressFill");
  const progressText = document.getElementById("progressText");

  const step = Math.max(1, path.length + (currentFinalRecommendation ? 1 : 0));
  const percent = Math.min(step * 20, 100);

  progressFill.style.width = percent + "%";
  progressText.textContent = `Step ${step}`;
}

/* ---------- HELPERS ---------- */
function escapeHtml(unsafe) {
  if (unsafe === null || unsafe === undefined) return "";
  return String(unsafe).replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"
  }[m]));
}

/* ---------- RENDER ---------- */
function renderNode(nodeObj, nodeKey = "root") {
  const flowArea = document.getElementById("flowArea");
  const suggestedPanel = document.getElementById("suggestedPanel");

  flowArea.innerHTML = "";
  document.getElementById("recommendation").innerHTML = "No recommendation yet.";
  document.getElementById("suggestedComment").innerHTML = "";
  document.getElementById("suggestedCorrCode").innerHTML = "";
  document.getElementById("suggestedEmail").innerHTML = "";
  suggestedPanel.style.display = "none";

  currentFinalRecommendation = "";

  if (nodeObj?.choices?.length) {
    flowArea.innerHTML = `<strong>${escapeHtml(nodeObj.text)}</strong>`;

    const list = document.createElement("div");
    list.className = "choice-list";

    nodeObj.choices.forEach(choice => {
      const btn = document.createElement("div");
      btn.className = "choice";
      btn.textContent = choice.label;

      btn.onclick = () => {
        historyStack.push({ nodeKey, path: [...path] });
        path.push({ question: nodeObj.text, answer: choice.label });

        const nextNode = NODES[choice.next];
        if (!nextNode) {
          alert("Configuration error: missing node");
          return;
        }

        renderNode(nextNode, choice.next);
        updateSelectedPath();
        updateProgress();
      };

      list.appendChild(btn);
    });

    flowArea.appendChild(list);
  } else {
    // FINAL NODE
    currentFinalRecommendation = nodeObj.text;

    document.getElementById("recommendation").innerHTML =
      `<strong>${escapeHtml(nodeObj.text)}</strong>`;

    updateSelectedPath();
    generateSuggestedCommentEmail(nodeObj.text);
    updateProgress();
  }

  document.getElementById("goBackBtn").style.display =
    historyStack.length ? "inline-block" : "none";

  document.getElementById("startOverBtn").style.display =
    path.length ? "inline-block" : "none";
}


/* ---------- PATH ---------- */
function updateSelectedPath(){
  const el=document.getElementById("selectedPath");
  if(!path.length){ el.innerHTML = "No steps selected yet."; return; }
  el.innerHTML = path.map((p,idx)=>`<strong>Step ${idx+1}:</strong> ${escapeHtml(p.question)} ‚Üí <strong><em>${escapeHtml(p.answer)}</em></strong>`).join("<br>");
}

/* ---------- LOAD SUGGESTED ---------- */
function generateSuggestedCommentEmail(finalText){
  const commentBox=document.getElementById("suggestedComment");
  const corrBox=document.getElementById("suggestedCorrCode");
  const emailBox=document.getElementById("suggestedEmail");
  const panel=document.getElementById("suggestedPanel");

  if(!finalText) return;

  const docId=encodeURIComponent(finalText);

  if(typeof window.loadFromFirestore==="function"){
    _firestoreLoadAttempts[docId]=0;
    window.loadFromFirestore(docId).then(data=>{
      commentBox.innerHTML=data.comment || `VS-BLER-CASE#-${finalText}`;
      corrBox.innerHTML=data.corrCode || "";
      emailBox.innerHTML=(data.email || `Hi,\n\n${finalText}\n\nThank you,\nEBS Operations - Invoicing Solutions`).replace(/\n/g,"<br>");
      panel.style.display="block";
    });
  } else {
    _firestoreLoadAttempts[docId]=(_firestoreLoadAttempts[docId]||0)+1;
    if(_firestoreLoadAttempts[docId]<10){
      setTimeout(()=>generateSuggestedCommentEmail(finalText),200);
    }
  }
}

/* ---------- EDIT ---------- */
function attemptEdit(type){
  currentEditType=type;
  document.getElementById("adminPassword").value="";
  document.getElementById("passwordModal").style.display="flex";
}

function checkPassword(){
  if(document.getElementById("adminPassword").value==="admin"){
    document.getElementById("passwordModal").style.display="none";
    openEditModal();
  } else alert("Incorrect password");
}

function openEditModal(){
  if(!currentFinalRecommendation) return;
  const map={
    comment:"suggestedComment",
    corr:"suggestedCorrCode",
    email:"suggestedEmail"
  };
  const el=document.getElementById(map[currentEditType]);
  document.getElementById("editTextarea").value=
    el.innerHTML.replace(/<br\s*\/?>/g,"\n");
  document.getElementById("modalTitle").textContent=
    currentEditType==="corr"?"Edit CORR CODE":"Edit "+currentEditType;
  document.getElementById("editModal").style.display="flex";
}

async function saveEdit(){
  const val = document.getElementById("editTextarea").value;
  const docId = encodeURIComponent(currentFinalRecommendation);

  try {
    if (currentEditType === "comment") {
      await saveCommentToFirestore(docId, val);
      document.getElementById("suggestedComment").innerHTML = val;
    }

    if (currentEditType === "corr") {
      await saveCorrCodeToFirestore(docId, val);
      document.getElementById("suggestedCorrCode").innerHTML = val;
    }

    if (currentEditType === "email") {
      await saveEmailToFirestore(docId, val);
      document.getElementById("suggestedEmail").innerHTML =
        val.replace(/\n/g, "<br>");
    }

    alert("‚úÖ Successfully saved to Firestore.");

  } catch (err) {
    console.error("Firestore save failed:", err);
    alert("‚ùå Save failed. Please try again.");

  } finally {
    // ‚úÖ ALWAYS close modal and release overlay
    document.getElementById("editModal").style.display = "none";
  }
}

/* ---------- gobackstart again ---------- */
document.getElementById("goBackBtn").onclick = () => {
  if (!historyStack.length) return;

  const last = historyStack.pop();
  path = last.path || [];

  renderNode(NODES[last.nodeKey] || TREE, last.nodeKey);
  updateSelectedPath();
  updateProgress();
};

document.getElementById("startOverBtn").onclick = () => {
  path = [];
  historyStack = [];
  currentFinalRecommendation = "";

  document.getElementById("selectedPath").textContent =
    "No steps selected yet.";

  document.getElementById("suggestedPanel").style.display = "none";

  renderNode(TREE, "root");
  updateProgress();
};

/* ---------- INIT ---------- */
window.addEventListener("load", () => {
  renderNode(TREE, "root");
  updateProgress();
});
</script>

<!-- ---------- FIREBASE MODULE: placed at bottom as requested (Option A) ---------- -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDjaMdeh0Cgx00hzDyZOi54fDkR81wnxJU",
  authDomain: "bdgg-database.firebaseapp.com",
  projectId: "bdgg-database",
  storageBucket: "bdgg-database.firebasestorage.app",
  messagingSenderId: "43574975434",
  appId: "1:43574975434:web:4c79e581267fdfcc6ccd33"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

export async function saveCommentToFirestore(id,val){
  return setDoc(doc(db,"pricing_comments",id),{comment:val},{merge:true});
}
export async function saveEmailToFirestore(id,val){
  return setDoc(doc(db,"pricing_emails",id),{email:val},{merge:true});
}
export async function saveCorrCodeToFirestore(id,val){
  return setDoc(doc(db,"pricing_corr_codes",id),{corrCode:val},{merge:true});
}

export async function loadFromFirestore(id){
  const [c,e,r]=await Promise.all([
    getDoc(doc(db,"pricing_comments",id)),
    getDoc(doc(db,"pricing_emails",id)),
    getDoc(doc(db,"pricing_corr_codes",id))
  ]);
  return {
    comment:c.exists()?c.data().comment:"",
    email:e.exists()?e.data().email:"",
    corrCode:r.exists()?r.data().corrCode:""
  };
}

window.saveCommentToFirestore=saveCommentToFirestore;
window.saveEmailToFirestore=saveEmailToFirestore;
window.saveCorrCodeToFirestore=saveCorrCodeToFirestore;
window.loadFromFirestore=loadFromFirestore;
</script>


</body>
</html>
