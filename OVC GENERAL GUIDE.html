<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>OVC Decision Guide</title>
<style>
:root{
  --bg:#f4f7fb;
  --card:#ffffff;
  --muted:#64748b;
  --accent:#4d148c;
  --accent-2:#ff6600;
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  color:#0f172a;
}
*{box-sizing:border-box}
body{margin:0;background:linear-gradient(180deg,var(--bg),#eef6ff);display:flex;flex-direction:column;min-height:100vh;}
header, footer{background:var(--accent);color:white;padding:16px 28px;}
header h1, footer p{margin:0;font-weight:600;}
.container{max-width:1400px;margin:0 auto;display:grid;grid-template-columns:1fr 1fr 420px;gap:20px;align-items:start;padding:28px 0;flex:1}
.card{background:var(--card);border-radius:12px;padding:18px;box-shadow:0 8px 28px rgba(2,6,23,0.06);overflow:hidden}
h1{margin:0;font-size:22px;color:var(--accent)}
p.lead{margin:6px 0 14px;color:var(--muted);font-size:13px}
.progress-container{display:flex;align-items:center;gap:10px;margin:14px 0}
.progress-bar{flex:1;height:10px;background:#e2e8f0;border-radius:999px;overflow:hidden}
.progress-fill{height:100%;width:0%;background:var(--accent);transition:width .3s}
.progress-text{font-size:13px;color:var(--muted)}
.node{padding:12px;border-radius:10px;border:1px solid rgba(3,7,18,0.05);background:linear-gradient(180deg,#ffffff,#fbfeff);margin:10px 0;min-height:64px}
.choice-list{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
.choice{padding:8px 12px;border-radius:999px;background:#eef8f7;border:1px solid rgba(4,20,20,0.03);cursor:pointer;font-weight:600}
.choice:hover{background:#e0f2fe}
.choice.active{background:var(--accent);color:white}
.path{margin-top:12px;padding:10px;border-radius:10px;background:#f8fafc;border:1px dashed rgba(3,7,18,0.04);font-size:13px}
.path strong{color:var(--accent)}
.result{margin-top:12px;padding:12px;border-radius:10px;background:#e6fbfb;border-left:4px solid var(--accent-2);animation:fadeIn 0.4s ease-in;min-height:56px}
.note{margin-top:6px;font-size:13px;color:var(--muted);font-style:italic}
.controls{display:flex;gap:8px;margin-top:12px}
button{background:var(--accent);color:white;border:none;padding:9px 12px;border-radius:9px;cursor:pointer;font-weight:600}
button.secondary{background:#fff;color:var(--accent);border:1px solid #ccc}
.output-card{margin-top:16px;padding:14px;border-radius:10px;background:#ffffff;box-shadow:0 4px 12px rgba(0,0,0,0.05);animation:fadeIn 0.45s ease-in;position:relative}
.output-header{font-weight:700;color:var(--accent);margin-bottom:8px ;color:#000 !important;display:flex;justify-content:space-between;align-items:center;}
.output-box{
  padding:10px;
  border-left:4px solid var(--accent-2);
  background:#f8fafc;
  border-radius:8px;
  white-space:pre-wrap;
   font-size:11px; 
}
.copy-btn{background:var(--accent);color:white;border:none;padding:6px 10px;margin-top:10px;border-radius:6px;cursor:pointer;font-size:13px}
.copy-btn:hover{opacity:.85}
.extra-note{margin-top:8px;font-size:13px;color:var(--muted);font-style:italic}
.edit-icon{cursor:pointer;font-size:16px;color:var(--accent);margin-left:8px}
.edit-icon:hover{text-decoration:underline}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);align-items:center;justify-content:center;z-index:1000}
.modal-content{background:white;padding:20px;border-radius:10px;min-width:300px;text-align:center}
textarea{resize:none}
@keyframes fadeIn {from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
@media(max-width:1200px){.container{grid-template-columns:1fr}}

/* ---------- MODAL STYLES ---------- */
.modal {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.45);
  align-items: center;
  justify-content: center;
  z-index: 1000;
  animation: fadeIn 0.3s ease;
}

.modal-content {
  background: #fff;
  padding: 25px 30px;
  border-radius: 12px;
  min-width: 500px;      
  max-width: 600px;       
  box-shadow: 0 12px 28px rgba(0,0,0,0.2);
  text-align: center;
  font-family: Inter, sans-serif;
}

.modal-content h3 {
  margin-top: 0;
  margin-bottom: 15px;
  font-size: 18px;
  font-weight: 600;
  color: var(--accent);
}

.modal-content input[type="password"], 
.modal-content textarea {
  width: 100%;
  padding: 10px 12px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  font-size: 14px;
  margin-top: 10px;
  font-family: Inter, sans-serif;
}

.modal-content textarea {
  min-height: 120px;
  resize: vertical;
}

.modal-content button {
  border: none;
  padding: 8px 16px;
  border-radius: 8px;
  font-weight: 600;
  font-size: 14px;
  margin-left: 6px;
  cursor: pointer;
  transition: all 0.2s ease;
}

.modal-content button:hover {
  opacity: 0.9;
}

.modal-content .save-btn {
  background-color: var(--accent);
  color: #fff;
}

.modal-content .cancel-btn {
  background-color: #e5e7eb;
  color: #111827;
}

@media(max-width:500px){
  .modal-content { width: 90%; min-width: unset; padding:20px; }
}
</style>
</head>
<body>

<header style="display:flex;align-items:center;justify-content:space-between;">
  <div style="display:flex;align-items:center;gap:12px;">
     <img src="fedex.png" alt="FedEx Logo" style="height:40px;">
    <h1>OVC Decision Guide</h1>
  </div>
  <div style="display:flex;gap:8px;">
    <button onclick="window.location.href='index.html'">Main Page</button>
    <button onclick="window.location.href='BD GENERAL GUIDE.html'">Go to BD General Guide</button>
  </div>
</header>

<div class="container">
  <div class="card">
    <h1>OVC Decision Guide</h1>
    <p class="lead">Follow the flow below to determine the OVC recommended action.</p>
    <div class="progress-container">
      <div class="progress-bar"><div id="progressFill" class="progress-fill"></div></div>
      <div id="progressText" class="progress-text"></div>
    </div>
    <div id="flowArea" class="node"></div>
    <div class="controls">
      <button id="goBackBtn" class="secondary" style="display:none;">‚Üê Go Back</button>
      <button id="startOverBtn" class="secondary" style="display:none;">Start Over</button>
    </div>
  </div>

  <div class="card">
    <div class="node">
      <strong>Selected Path</strong>
      <div id="selectedPath" class="path">No steps selected yet.</div>
    </div>
    <div class="node">
      <strong>Recommended Action</strong>
      <div id="recommendation" class="result">No recommendation yet.</div>
    </div>
  </div>

  <div class="card" id="suggestedPanel" style="display:none;">
    <div class="output-card" id="commentCard">
      <div class="output-header">
        Suggested Comment
        <span class="edit-icon" onclick="attemptEdit('comment')" title="Do you want to update the Comment?">‚úèÔ∏è</span>
      </div>
      <div id="suggestedComment" class="output-box"></div>
    </div>
    
    <!-- ‚úÖ NEW: CORR CODE -->
    <div class="output-card" id="corrCard">
      <div class="output-header">
        Possible CORR CODE
        <span class="edit-icon" onclick="attemptEdit('corr')">‚úèÔ∏è</span>
      </div>
      <div id="suggestedCorrCode" class="output-box"></div>
    </div>
    
    <div class="output-card" id="emailCard">
      <div class="output-header">
        Suggested Email
        <span class="edit-icon" onclick="attemptEdit('email')" title="Do you want to update the Email?">‚úèÔ∏è</span>
      </div>
      <div id="suggestedEmail" class="output-box"></div>
      <button class="copy-btn" id="copyEmailBtn">üìã Copy</button>
    </div>
    <div id="generalNote" class="note">Note: These are suggested templates. Personalized emails or comments are always more appreciated.</div>
  </div>
</div>

<footer style="display:flex;align-items:center;justify-content:space-between;">
  <p>¬© 2025 EBS Operations</p>
  <div style="display:flex;align-items:center;gap:10px;">
    <span style="font-size:12px;color:white;">
      "Your feedback is important to us. Please feel free to email us with any comments or questions." -Jules
    </span>
  </div>
</footer>

<!-- Password Modal -->
<div id="passwordModal" class="modal">
  <div class="modal-content">
    <h3>Enter Password to Edit</h3>
    <input type="password" id="adminPassword" placeholder="Password">
    <div style="margin-top:18px;">
      <button class="save-btn" onclick="checkPassword()">Submit</button>
      <button class="cancel-btn" onclick="closePasswordModal()">Cancel</button>
    </div>
  </div>
</div>

<!-- Edit Modal -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <h3 id="modalTitle">Edit</h3>
    <div id="modalHint" class="note" style="margin-bottom:6px;"></div>
    <textarea id="editTextarea"></textarea>
    <div style="margin-top:18px;text-align:right;">
      <button class="save-btn" onclick="saveEdit()">Save</button>
      <button class="cancel-btn" onclick="closeEditModal()">Cancel</button>
    </div>
  </div>
</div>

<script>
/* ---------- DECISION TREE ---------- */
/* ---------- OVC DECISION TREE (kept same) ---------- */
const TREE = {
  id: "root",
  text: "Is the invoice paid and closed?",
  choices: [
    { label: "Yes", next: "paid_closed" },
    { label: "No", next: "not_paid_closed" }
  ]
};

const NODES = {
  paid_closed: {
    id: "paid_closed",
    text: "Is it within 180 + 7 days?",
    choices: [
      { label: "Yes", next: "within_days" },
      { label: "No", next: "billers_error" }
    ]
  },
  billers_error: {
    id: "billers_error",
    text: "Is it a biller's error?",
    choices: [
      { label: "Yes", next: "within_days" },
      { label: "No", next: "not_billers_error" }
    ]
  },
  not_billers_error: { id: "not_billers_error", text: "Deny the claim. Claims should be file within 180+7 days per item 438", choices: [] },
  not_paid_closed: { id: "not_paid_closed", text: "Move the case to the appropriate queue(BD or PRICING).", choices: [] },
  within_days: {
    id: "within_days",
    text: "Is there an OVC form provided?",
    choices: [
      { label: "Yes", next: "type_of_dispute" },
      { label: "No", next: "ask_for_form" }
    ]
  },
  proceed_review: { id: "proceed_review", text: "Proceed on reviewing the claim.", choices: [] },
  ask_for_form: { id: "ask_for_form", text: "Respond to the customer and ask for the OVC form.", choices: [] },
  deny_claim: { id: "deny_claim", text: "Deny the claim. Claims should be filed within 180 + 7 days per per item 438.", choices: [] },
  type_of_dispute: {
    id: "type_of_dispute",
    text: "Review Claim. What is the type of dispute?",
    choices: [
      { label: "Priority Plus Shipment", next: "priority_plus" },
      { label: "Intra-Canada Shipment", next: "intra_canada" },
      { label: "Inspected Shipment", next: "inspected_shipment" },
      { label: "Reweigh Concern", next: "reweigh_concern" },
      { label: "Billing Dispute Concern", next: "billing_dispute" },
      { label: "Pricing Concern", next: "pricing_concern" },
      { label: "International Shipment", next: "international_shipment" },
      { label: "Detention / Redelivery / Limited Access / Port", next: "detention_cases" },
      { label: "GTE / GAMD and CDW", next: "otc_gems_cow" }
    ]
  },
  priority_plus: {
    id: "priority_plus",
    text: "Send dispute to Priorityplus@fedex.com using OSV email. Is the dispute accepted by the Reviewing Party?",
    choices: [{ label: "Yes", next: "process_on_tms" }, { label: "No", next: "educate_customer" }]
  },
  intra_canada: {
    id: "intra_canada",
    text: "Send dispute to Domesticrates@fedex.com using OSV email. Is the dispute accepted by the Reviewing Party?",
    choices: [{ label: "Yes", next: "process_on_tms" }, { label: "No", next: "educate_customer" }]
  },
  inspected_shipment: {
    id: "inspected_shipment",
    text: "Send dispute to Freightresearch@fedex.com using OSV email. Is the dispute accepted by the Reviewing Party?",
    choices: [{ label: "Yes", next: "process_on_tms" }, { label: "No", next: "educate_customer" }]
  },
  reweigh_concern: {
    id: "reweigh_concern",
    text: "Follow Reweigh Process and use FBC to calculate the credit. Did we pull up the claim amount after autorating?",
    choices: [{ label: "Yes", next: "final_note" }, { label: "No", next: "final_notes"}]
  },
  billing_dispute: {
    id: "billing_dispute",
    text: "Follow Billing Dispute Process and use FBC to calculate the credit. Did we pull up the claim amount after autorating?",
    choices: [{ label: "Yes", next: "final_note" }, { label: "No", next: "final_notes" }]
  },
  pricing_concern: {
    id: "pricing_concern",
    text: "Follow Pricing Process and use FBC to calculate the credit. Did we pull up the claim amount after autorating?",
    choices: [{ label: "Yes", next: "final_note" }, { label: "No", next: "final_notes" }]
  },
  international_shipment: {
    id: "international_shipment",
    text: "Send dispute to Tina Stewart and Andrea Staats email. Is the dispute accepted by the Reviewing Party?",
    choices: [{ label: "Yes", next: "process_on_tms" }, { label: "No", next: "educate_customer" }]
  },
  detention_cases: {
    id: "detention_cases",
    text: "Move the case to SBL Emails queue and add OVC+Dispute' on the subject line. Is the dispute accepted by the Reviewing Party?",
    choices: [{ label: "Yes", next: "process_on_tms" }, { label: "No", next: "educate_customer" }]
  },
  otc_gems_cow: {
    id: "otc_gems_cow",
    text: "Move the case to FXF Guaranteed Service Dispute Queue. Is the dispute accepted by the Reviewing Party?",
    choices: [{ label: "Yes", next: "process_on_tms" }, { label: "No", next: "educate_customer" }]
  },
  reviewing_party_response: {
    id: "reviewing_party_response",
    text: "Dispute accepted by the Reviewing Party?",
    choices: [{ label: "Yes", next: "process_on_tms" }, { label: "No", next: "educate_customer" }]
  },
  process_on_tms: { id: "process_on_tms", text: "Go ahead and process the claim on TFMS.", choices: [] },
  educate_customer: { id: "educate_customer", text: "Educate the customer accordingly.", choices: [] },
  use_fbc: { id: "use_fbc", text: "Use FBC to calculate the credit.", choices: [] },
  autorate_check: {
    id: "autorate_check",
    text: "After autorating, did we pull up the claim amount?",
    choices: [{ label: "Yes", next: "process_on_tms" }, { label: "No", next: "educate_customer" }]
  },
  final_note: { id: "final_note", text: "<p>Go ahead and process the claim on TFMS.</p><p><em> NOTE: For Billing Incorrectly Pros, correction needs to be done on FBC.</p></em>", choices: [] },
  final_notes: { id: "final_notes", text: "Educate the customer accordingly.<br><br><em> NOTE: For Billing Incorrectly Pros, correction needs to be done on FBC.</em>", choices: [] }
};

/* ---------- STATE ---------- */
let path = [];
let historyStack = [];
let currentFinalRecommendation = "";
let currentEditType = "";
const _firestoreLoadAttempts = {};

/* ---------- RENDER ---------- */
function renderNode(nodeObj, nodeKey="root") {
  const flowArea = document.getElementById("flowArea");
  const goBackBtn = document.getElementById("goBackBtn");
  const startOverBtn = document.getElementById("startOverBtn");
  const progressFill = document.getElementById("progressFill");
  const suggestedPanel = document.getElementById("suggestedPanel");

  flowArea.innerHTML = "";
  document.getElementById("recommendation").innerHTML = "No recommendation yet.";
  document.getElementById("suggestedComment").innerHTML = "";
  document.getElementById("suggestedEmail").innerHTML = "";
  document.getElementById("suggestedCorrCode").innerHTML = "";
  suggestedPanel.style.display = "none";

  if (nodeObj && nodeObj.text && nodeObj.choices && nodeObj.choices.length) {
    const q = document.createElement("div");
    q.innerHTML = `<strong style="font-size:16px">${nodeObj.text}</strong>`;
    flowArea.appendChild(q);

    const list = document.createElement("div");
    list.className = "choice-list";

    nodeObj.choices.forEach(choice => {
      const btn = document.createElement("div");
      btn.className = "choice";
      btn.textContent = choice.label;
      btn.onclick = () => {
        historyStack.push({ nodeKey, path: JSON.parse(JSON.stringify(path)) });
        path.push({ question: nodeObj.text, answer: choice.label });

        const nextNode = NODES[choice.next] || {};
        if (nextNode && nextNode.text && (!nextNode.choices || nextNode.choices.length === 0)) {
          currentFinalRecommendation = nextNode.text;
          document.getElementById("recommendation").innerHTML = `<strong>${currentFinalRecommendation}</strong>`;
          generateSuggestedTemplates(currentFinalRecommendation);
        } else {
          currentFinalRecommendation = "";
          suggestedPanel.style.display = "none";
        }

        renderNode(nextNode, choice.next);
        updateSelectedPath();
      };
      list.appendChild(btn);
    });

    flowArea.appendChild(list);
  } else if (nodeObj && nodeObj.text) {
    currentFinalRecommendation = nodeObj.text;
    document.getElementById("recommendation").innerHTML = `<strong>${currentFinalRecommendation}</strong>`;
    updateSelectedPath();
    generateSuggestedTemplates(currentFinalRecommendation);
  }

  goBackBtn.style.display = historyStack.length ? "inline-block" : "none";
  startOverBtn.style.display = path.length ? "inline-block" : "none";

  const stepNum = path.length + 1;
  progressFill.style.width = Math.min(stepNum*20,100)+"%";
  document.getElementById("progressText").textContent = `Step ${stepNum}`;
}

function updateSelectedPath(){
  const el = document.getElementById("selectedPath");
  if (!path.length) { el.innerHTML = "No steps selected yet."; return; }
  el.innerHTML = path.map((p,idx) =>
    `<strong>Step ${idx+1}:</strong> ${p.question} ‚Üí <strong><em>${p.answer}</em></strong>`
  ).join("<br>");
}

/* ---------- SUGGESTED COMMENT, EMAIL & CORR CODE ---------- */
function generateSuggestedTemplates(finalText){
  const commentBox = document.getElementById("suggestedComment");
  const emailBox = document.getElementById("suggestedEmail");
  const corrBox = document.getElementById("suggestedCorrCode");
  const panel = document.getElementById("suggestedPanel");

  if (!finalText) { panel.style.display="none"; return; }
  const docId = encodeURIComponent(finalText);

  if (typeof window.loadFromFirestore === "function") {
    _firestoreLoadAttempts[docId] = 0;
    window.loadFromFirestore(docId).then(data=>{
      commentBox.innerHTML = data.comment || `VS-BLER-CASE#-${finalText}`;
      emailBox.innerHTML = data.email ? data.email.replace(/\n/g,"<br>") : `Hi,<br><br>${finalText}<br><br>Thank you,<br>EBS Operations - Invoicing Solutions`;
      corrBox.innerHTML = data.corr || `CORR-${finalText}`;
      panel.style.display="block";
    }).catch(err=>{
      console.error(err);
      commentBox.innerHTML = `VS-BLER-CASE#-${finalText}`;
      emailBox.innerHTML = `Hi,<br><br>${finalText}<br><br>Thank you,<br>EBS Operations - Invoicing Solutions`;
      corrBox.innerHTML = `CORR-${finalText}`;
      panel.style.display="block";
    });
  } else {
    // fallback retries
    _firestoreLoadAttempts[docId] = (_firestoreLoadAttempts[docId]||0)+1;
    if(_firestoreLoadAttempts[docId]<=10){
      setTimeout(()=>generateSuggestedTemplates(finalText),200); return;
    }
    commentBox.innerHTML = `VS-BLER-CASE#-${finalText}`;
    emailBox.innerHTML = `Hi,<br><br>${finalText}<br><br>Thank you,<br>EBS Operations - Invoicing Solutions`;
    corrBox.innerHTML = `CORR-${finalText}`;
    panel.style.display="block";
  }
}

/* ---------- ADMIN EDIT ---------- */
function attemptEdit(type){
  currentEditType = type;
  document.getElementById("adminPassword").value="";
  document.getElementById("passwordModal").style.display="flex";
}

function closePasswordModal(){document.getElementById("passwordModal").style.display="none";}

function checkPassword(){
  if(document.getElementById("adminPassword").value==="admin"){
    closePasswordModal();
    openEditModal();
  }else alert("Incorrect password!");
}

function openEditModal(){
  const currentBox = currentEditType==="comment"?"suggestedComment":(currentEditType==="email"?"suggestedEmail":"suggestedCorrCode");
  const currentHtml = document.getElementById(currentBox).innerHTML||"";
  document.getElementById("editTextarea").value = currentHtml.replace(/<br\s*\/?>/ig,"\n");
  document.getElementById("modalTitle").textContent=`Edit ${currentEditType.toUpperCase()}`;
  document.getElementById("modalHint").textContent="Edits will be saved to Firestore (collection: ovc_templates).";
  document.getElementById("editModal").style.display="flex";
}

function closeEditModal(){document.getElementById("editModal").style.display="none";}

function saveEdit(){
  const val=document.getElementById("editTextarea").value;
  if(!currentFinalRecommendation){alert("No recommendation selected to save!");return;}
  const docId=encodeURIComponent(currentFinalRecommendation);
  if(typeof window.saveTemplateToFirestore!=="function"){alert("Saving not ready yet.");closeEditModal();return;}
  const payload={};
  if(currentEditType==="comment") payload.comment=val;
  else if(currentEditType==="email") payload.email=val;
  else if(currentEditType==="corr") payload.corr=val;

  window.saveTemplateToFirestore(docId,payload).then(()=>{
    if(currentEditType==="comment") document.getElementById("suggestedComment").innerHTML=val;
    else if(currentEditType==="email") document.getElementById("suggestedEmail").innerHTML=val.replace(/\n/g,"<br>");
    else if(currentEditType==="corr") document.getElementById("suggestedCorrCode").innerHTML=val;
    document.getElementById("suggestedPanel").style.display="block";
    closeEditModal();
    alert("‚úÖ Successfully saved to Firestore.");
  }).catch(err=>{
    console.error(err);
    alert("‚ùå Save failed. Please try again.");
  });
}

/* ---------- BUTTON EVENTS ---------- */
document.getElementById("goBackBtn").onclick = ()=>{
  if(historyStack.length){
    const last=historyStack.pop();
    path=last.path||[];
    renderNode(NODES[last.nodeKey]||TREE,last.nodeKey);
    updateSelectedPath();
  }
};

document.getElementById("startOverBtn").onclick = ()=>{
  path=[]; historyStack=[]; currentFinalRecommendation="";
  document.getElementById("selectedPath").textContent="No steps selected yet.";
  document.getElementById("suggestedPanel").style.display="none";
  renderNode(TREE,"root");
};

document.getElementById("copyEmailBtn").onclick = ()=>{
  const txt=document.getElementById("suggestedEmail").innerText||"";
  navigator.clipboard.writeText(txt).then(()=>alert("Email copied!")).catch(()=>alert("Unable to copy."));
};

/* ---------- INIT ---------- */
window.addEventListener('load',()=>{renderNode(TREE,"root");});
</script>

<!-- ---------- FIREBASE MODULE ---------- -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDjaMdeh0Cgx00hzDyZOi54fDkR81wnxJU",
  authDomain: "bdgg-database.firebaseapp.com",
  projectId: "bdgg-database",
  storageBucket: "bdgg-database.firebasestorage.app",
  messagingSenderId: "43574975434",
  appId: "1:43574975434:web:4c79e581267fdfcc6ccd33"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function saveTemplateToFirestore(docId, partial){
  if(!docId) throw new Error("docId required");
  if(!partial||typeof partial!=="object") throw new Error("partial object required");
  await setDoc(doc(db,"ovc_templates",docId),partial,{merge:true});
}

async function loadFromFirestore(docId){
  if(!docId) return {};
  const docRef = doc(db,"ovc_templates",docId);
  const snap = await getDoc(docRef);
  if(!snap.exists()) return {};
  return snap.data() || {};
}

window.saveTemplateToFirestore = saveTemplateToFirestore;
window.loadFromFirestore = loadFromFirestore;
</script>

</body>
</html>
