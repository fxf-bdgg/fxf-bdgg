<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BD Tools ‚Äî EBS Response Template</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
:root{
  --bg:#f4f7fb;
  --card:#ffffff;
  --muted:#64748b;
  --accent:#4d148c;
  --accent-dark:#3a0f6b;
  --warning:#ff9800;
  --warning-light:#fff3e0;
  font-family: Inter, ui-sans-serif, system-ui;
}
*{box-sizing:border-box;}
body{margin:0;background:linear-gradient(180deg,var(--bg),#eef6ff);display:flex;flex-direction:column;min-height:100vh;}
header{background:var(--accent);color:white;padding:16px 28px;display:flex;align-items:center;justify-content:space-between;}
header img{height:40px;}
.nav-tabs{display:flex;gap:30px;}
.tab{color:white;text-decoration:none;font-weight:600;font-size:16px;position:relative;padding:6px 0;}
.tab.active::after{content:"";position:absolute;left:0;bottom:-6px;width:100%;height:3px;background:#ff6600;border-radius:3px;}
.main{flex:1;padding:40px;display:flex;justify-content:center;}
.message-box{background:white;padding:40px;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,0.08);width:100%;max-width:1800px;}
.control-group{display:flex;gap:20px;align-items:center;margin:20px 0;}
select{padding:12px 14px;border-radius:8px;border:1px solid #e2e8f0;font-size:15px;min-width:400px;}
.response-item{background:#f8fafc;border:1px solid #e2e8f0;border-radius:10px;padding:20px;margin-bottom:20px;}
.expandable-header{display:flex;align-items:center;gap:12px;cursor:pointer;padding:12px;background:#fff;border-radius:6px;border:1px solid #e2e8f0;}
.expandable-content{max-height:0;overflow:hidden;transition:max-height .3s ease;padding:0 12px;}
.expandable-content.expanded{max-height:500px;margin-bottom:12px;}
.response-text{background:white;padding:16px;border-radius:6px;border-left:4px solid var(--accent);white-space:pre-wrap;word-wrap:break-word;font-size:13px;line-height:1.6;}
.copy-btn{background:var(--accent);color:white;border:none;padding:8px 16px;border-radius:6px;cursor:pointer;font-size:13px;margin-top:12px;}
.copy-btn.copied{background:#28a745;}
.loading-message{text-align:center;color:var(--muted);padding:20px;font-style:italic;}
.error-message{background:#ffebee;border-left:5px solid #d32f2f;color:#c62828;padding:15px;border-radius:6px;margin:20px 0;}
footer{background:var(--accent);color:white;padding:16px;text-align:center;}
</style>
</head>

<body>

<header>
  <div style="display:flex;align-items:center;gap:40px;">
    <a href="index.html"><img src="fedex.png"></a>
    <nav class="nav-tabs">
      <a href="index.html" class="tab">Home</a>
      <a href="case-directory.html" class="tab">Case Directory</a>
      <a href="ebs-response-template.html" class="tab active">EBS Response</a>
    </nav>
  </div>
</header>

<div class="main">
  <div class="message-box">
    <h1 style="color:#4d148c;">EBS Response Template</h1>

    <div id="loadingStatus" class="loading-message">Loading response templates...</div>
    <div id="errorStatus"></div>

    <div class="control-group" id="controlGroup" style="display:none;">
      <label style="font-weight:600;">Select Concern:</label>
      <select id="concernSelect">
        <option value="">-- Choose a Concern --</option>
      </select>
    </div>

    <div id="responseContainer"></div>
  </div>
</div>

<footer>¬© 2025 EBS Operations</footer>

<script>
function toggleExpand(el){
  const content = el.nextElementSibling;
  content.classList.toggle('expanded');
}

function normalizeCell(text){
  if (!text) return "";
  return String(text)
    .replace(/\r\n/g, "\n")
    .replace(/\r/g, "\n")
    .replace(/\u2028|\u2029/g, "\n")
    .trim();
}

function populateDropdown(data){
  const select = document.getElementById('concernSelect');
  const concerns = [...new Set(data.map(r => r.Concern).filter(Boolean))].sort();
  concerns.forEach(c => {
    const opt = document.createElement('option');
    opt.value = c;
    opt.textContent = c;
    select.appendChild(opt);
  });
}

function displayResponses(concern){
  const container = document.getElementById('responseContainer');
  container.innerHTML = '';
  if(!concern) return;

  const templates = window.TEMPLATES.filter(r => r.Concern === concern);
  if(!templates.length){
    container.innerHTML = '<div class="loading-message">No templates found.</div>';
    return;
  }

  templates.forEach((t,i) => {
    container.innerHTML += `
      <div class="response-item">
        <div class="expandable-header" onclick="toggleExpand(this)">
          <strong style="color:#4d148c;">${t.Description || 'Response '+(i+1)}</strong>
        </div>
        <div class="expandable-content">
          <div><strong>Concern:</strong> ${t.Concern}</div>
          <div><strong>Description:</strong> ${t.Description || 'N/A'}</div>
        </div>
        <div class="response-text">${t['Response Template']}</div>
        <button class="copy-btn" onclick="copyToClipboard(this)">üìã Copy Template</button>
      </div>
    `;
  });
}

function copyToClipboard(btn){
  const text = btn.previousElementSibling.textContent;
  navigator.clipboard.writeText(text).then(() => {
    btn.textContent = '‚úì Copied!';
    btn.classList.add('copied');
    setTimeout(() => {
      btn.textContent = 'üìã Copy Template';
      btn.classList.remove('copied');
    }, 2000);
  });
}

document.getElementById('concernSelect').addEventListener('change', e => {
  displayResponses(e.target.value);
});

fetch("ebs-response.ods")
.then(res => res.arrayBuffer())
.then(data => {
  const workbook = XLSX.read(data, { type: 'array' });
  const sheet = workbook.Sheets[workbook.SheetNames[0]];
  const rows = XLSX.utils.sheet_to_json(sheet, { defval:"", raw:false, cellText:true });

  const templates = [];
  rows.forEach(row => {
    const concern = row['Concern'];
    if (!concern) return;
    Object.keys(row).forEach(col => {
      if (col !== 'Concern' && row[col]) {
        templates.push({
          Concern: concern,
          Description: col,
          'Response Template': normalizeCell(row[col])
        });
      }
    });
  });

  if(!templates.length) throw new Error("No valid templates found.");
  window.TEMPLATES = templates;

  populateDropdown(templates);
  document.getElementById('loadingStatus').style.display = 'none';
  document.getElementById('controlGroup').style.display = 'flex';
})
.catch(err => {
  document.getElementById('loadingStatus').style.display = 'none';
  document.getElementById('errorStatus').innerHTML =
    '<div class="error-message">‚ùå ' + err.message + '</div>';
});
</script>

</body>
</html>
