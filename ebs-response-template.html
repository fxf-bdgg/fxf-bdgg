<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>EBS Response Template</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
body{font-family:sans-serif;background:#f4f7fb;margin:0;padding:0;}
.main{padding:20px;max-width:1200px;margin:auto;}
select{padding:8px;margin-right:10px;}
.response-item{background:white;padding:15px;margin:10px 0;border-left:4px solid #4d148c;}
.copy-btn{padding:5px 10px;margin-top:10px;cursor:pointer;}
</style>
</head>
<body>
<div class="main">
<h2>EBS Response Template</h2>

<label>Concern:</label>
<select id="concernSelect"><option value="">-- Choose Concern --</option></select>

<label>Type:</label>
<select id="typeSelect" disabled><option value="">-- All Types --</option></select>

<div id="responseContainer"></div>
</div>

<script>
// toggle expand not needed now, simpler view
function copyToClipboard(btn){
  const text = btn.previousElementSibling.textContent;
  navigator.clipboard.writeText(text).then(()=>{btn.textContent='âœ“ Copied';setTimeout(()=>{btn.textContent='Copy Template';},1500);});
}

// populate Concern dropdown
function populateConcerns(){
  const select = document.getElementById('concernSelect');
  const concerns = [...new Set(window.TEMPLATES.map(r=>r.Concern).filter(Boolean))].sort();
  concerns.forEach(c=>{
    const opt=document.createElement('option');
    opt.value=c; opt.textContent=c;
    select.appendChild(opt);
  });
}

// populate Type dropdown based on selected Concern
function populateTypes(concern){
  const typeSelect = document.getElementById('typeSelect');
  typeSelect.innerHTML='<option value="">-- All Types --</option>';
  if(!concern){typeSelect.disabled=true; return;}
  const types=[...new Set(window.TEMPLATES.filter(t=>t.Concern===concern).map(t=>t.Type).filter(Boolean))];
  types.forEach(t=>{
    const opt=document.createElement('option');
    opt.value=t; opt.textContent=t;
    typeSelect.appendChild(opt);
  });
  typeSelect.disabled = types.length===0;
}

// display filtered templates
function displayTemplates(concern,type){
  const container=document.getElementById('responseContainer');
  container.innerHTML='';
  if(!concern) return;
  let templates = window.TEMPLATES.filter(t=>t.Concern===concern);
  if(type) templates=templates.filter(t=>t.Type===type);
  if(templates.length===0){container.innerHTML='No templates found.';return;}
  templates.forEach(t=>{
    const div=document.createElement('div');
    div.className='response-item';
    div.innerHTML=`<strong>Concern:</strong> ${t.Concern}<br><strong>Type:</strong> ${t.Type}<br><div>${t['Response Template']}</div><button class="copy-btn" onclick="copyToClipboard(this)">Copy Template</button>`;
    container.appendChild(div);
  });
}

// events
document.getElementById('concernSelect').addEventListener('change', e=>{
  const concern=e.target.value;
  populateTypes(concern);
  displayTemplates(concern,'');
});
document.getElementById('typeSelect').addEventListener('change', e=>{
  const concern=document.getElementById('concernSelect').value;
  const type=e.target.value;
  displayTemplates(concern,type);
});

// load ODS
fetch("ebs-response.ods").then(r=>r.arrayBuffer()).then(data=>{
  const wb=XLSX.read(data,{type:'array'});
  const sheet=wb.Sheets[wb.SheetNames[0]];
  window.TEMPLATES=XLSX.utils.sheet_to_json(sheet,{defval:""});
  populateConcerns();
}).catch(err=>{
  document.getElementById('responseContainer').textContent='Error loading ODS: '+err.message;
});
</script>
</body>
</html>
