<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BD Tools — EBS Response</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
:root{
  --bg:#f4f7fb;
  --card:#ffffff;
  --muted:#64748b;
  --accent:#4d148c;
  --accent-dark:#3a0f6b;
  font-family: Inter, ui-sans-serif, system-ui;
}
*{box-sizing:border-box;}
body{margin:0;background:linear-gradient(180deg,var(--bg),#eef6ff);min-height:100vh;display:flex;flex-direction:column;}

header{
  background:var(--accent);
  color:white;
  padding:16px 28px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.nav-tabs{display:flex;gap:30px;}
.tab{color:white;text-decoration:none;font-weight:600;}
.tab.active::after{content:"";display:block;height:3px;background:#ff6600;border-radius:3px;margin-top:4px;}

.main{flex:1;padding:40px;display:flex;justify-content:center;}
.message-box{
  background:white;
  padding:40px;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,0.08);
  width:100%;
  max-width:1400px;
}

.select-row{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px;}
select, textarea{
  width:100%;
  padding:12px 14px;
  border-radius:8px;
  border:1px solid #e2e8f0;
  font-size:15px;
}

textarea{min-height:180px;resize:vertical;}

.btn{
  background:var(--accent);
  color:white;
  border:none;
  padding:10px 18px;
  border-radius:8px;
  cursor:pointer;
  font-weight:600;
}
.btn:hover{background:var(--accent-dark);}

.note-box{
  margin-top:10px;
  background:#f8fafc;
  border-left:5px solid var(--accent);
  padding:12px;
  border-radius:6px;
  color:#334155;
  font-size:14px;
}

footer{background:var(--accent);color:white;padding:16px;text-align:center;}

/* ---------- POPUPS ---------- */
.modal {display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); justify-content:center; align-items:center; padding:20px; z-index:1000;}
.modal-content{background:white; border-radius:10px; padding:24px; width:100%; max-width:500px; box-shadow:0 10px 30px rgba(0,0,0,0.2);}
.modal-header{display:flex; justify-content:space-between; align-items:center; font-size:20px; font-weight:700; margin-bottom:12px;}
.modal-close{font-size:22px; cursor:pointer; color:var(--muted);}
.modal-close:hover{color:var(--accent);}

.comment-modal-footer{display:flex; justify-content:space-between; align-items:center; margin-top:12px;}
.link-text{color:var(--accent-dark); cursor:pointer; text-decoration:underline; font-size:14px; display:block; margin-top:10px;}

#timeCalendarPopup{display:none; position:absolute; top:60px; right:20px; background:white; border-radius:8px; box-shadow:0 8px 24px rgba(0,0,0,0.25); padding:16px; width:310px; z-index:900;}
#timeCalendarPopup h3{margin:0;text-align:center;font-size:18px;color:var(--accent-dark); margin-bottom:8px;}
.calendar-header{display:flex; justify-content:space-between; align-items:center; background:#f0f0f0; padding:8px; border-radius:6px;}
.calendar-header span{cursor:pointer;color:var(--accent-dark); font-weight:600;}
.calendar-title{font-weight:700;}
.calendar-grid{display:grid; grid-template-columns:repeat(7,1fr); gap:4px; margin-top:8px;}
.calendar-grid .day-name{text-align:center;font-size:12px;font-weight:700;color:var(--muted);}
.calendar-grid .day{text-align:center;padding:8px 0;font-size:14px;border-radius:50%;}
.calendar-grid .today{background:var(--accent);color:white;font-weight:700;}
.calendar-grid .day:hover{background:#f0f0f0;}

/* ---------- HEADER ---------- */
header{
  background:var(--accent);
  color:white;
  padding:16px 28px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  position:relative;
  overflow:hidden;
  z-index:1;
}
header img{height:40px; animation:logoFlyIn 1s ease-out forwards; opacity:0;}
.nav-tabs{display:flex; gap:30px;}
.tab{color:white; text-decoration:none; font-weight:600; font-size:16px; position:relative; padding:6px 0; transition: opacity 0.2s;}
.tab:hover{opacity:0.8;}
.tab.active::after{content:"";position:absolute;left:0;bottom:-6px;width:100%;height:3px;background:#ff6600;border-radius:3px;}

.header-icons{display:flex;align-items:center;gap:20px;}
#clockBtn{cursor:pointer; display:flex; align-items:center; gap:6px; font-size:18px; font-weight:600; color:white; position:relative;}
#clockBtn:hover{transform:scale(1.1);}
.header-icon{font-size:24px;color:white;cursor:pointer;transition:color .2s,transform .2s;}
.header-icon:hover{transform:scale(1.3);}
.header-icon.active{color:var(--accent-dark);}

/* ---------- HEADER ANIMATIONS ---------- */
@keyframes logoFlyIn {0%{opacity:0;transform:translateX(-50px) scale(0.8);}100%{opacity:1;transform:translateX(0) scale(1);}}
header::after{
  content:"";
  position:absolute; top:0; left:-100%;
  width:100%; height:100%;
  background: linear-gradient(120deg, #4d148c, #ff6600, #4d148c);
  transform:skewX(-20deg);
  animation:sweep 1s ease-out forwards;
  z-index:0;
  opacity:0.2;
}
@keyframes sweep{0%{left:-100%;}100%{left:100%;}}

/* ---------- FED-EX ORANGE & PURPLE BANNER ---------- */
.welcome-section {
  background: linear-gradient(90deg, #4D148C 0%, #330d5e 50%, #FF6600 100%);
  background-size: 200% 200%;
  animation: fedexShimmer 15s ease infinite; /* slow shimmer */
  color: white;
  padding: 15px 30px;   /* compact height */
  text-align: left;     /* left-aligned text */
  margin-bottom: 20px;
  box-shadow: 0 5px 15px rgba(77, 20, 140, 0.15); /* subtle shadow */
  border-radius: 0;     /* straight edges */
}

/* Shimmer animation */
@keyframes fedexShimmer {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

.welcome-content h1 {
  font-size: 2rem;  /* compact heading */
  margin-bottom: 6px;
  font-weight: 800;
  letter-spacing: -0.5px;
}

.welcome-content p {
  font-size: 1rem;  /* smaller subtitle */
  max-width: 600px;
  margin: 0;
  opacity: 0.9;
  line-height: 1.5;
}

/* ---------- CAUTION/REMINDER BANNER ---------- */
.caution-banner{
background:var(--warning-light);
border-left:5px solid var(--warning);
border-radius:8px;
padding:20px;
margin-bottom:30px;
display:flex;
gap:15px;
}

.caution-icon{
font-size:28px;
color:var(--warning);
flex-shrink:0;
}

.caution-content h3{
margin:0 0 10px 0;
color:var(--warning);
font-size:16px;
}

.caution-content p{
margin:8px 0;
color:#333;
font-size:14px;
line-height:1.5;
}

.caution-content ul{
margin:10px 0;
padding-left:20px;
color:#333;
font-size:14px;
}

.caution-content li{
margin:6px 0;
line-height:1.5;
}

/* ---------- CAUTION/REMINDER BANNER ---------- */
.caution-banner{
  background: #FFE5CC; /* Light FedEx orange */
  border-left:5px solid #FF6600; /* FedEx orange */
  border-radius:8px;
  padding:20px;
  margin-bottom:30px;
  display:flex;
  gap:15px;
}

.caution-icon{
  font-size:28px;
  color:#FF6600; /* FedEx orange icon */
  flex-shrink:0;
}

.caution-content h3{
  margin:0 0 10px 0;
  color:#FF6600; /* FedEx orange title */
  font-size:16px;
}

.caution-content p,
.caution-content ul,
.caution-content li{
  color:#333; /* dark text for readability */
  font-size:14px;
  line-height:1.5;
}

</style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center;gap:40px;">
    <a href="index.html">
  <img src="fedex.png" alt="FedEx Logo" style="height:40px;">
</a>
    <nav class="nav-tabs">
     <a href="index.html" class="tab">Home</a>
      <a href="case-directory.html" class="tab">Case Directory</a>
      <a href="ebs-response-template.html" class="tab active">EBS Response</a>
      <a href="volume-application.html" class="tab">Volume Application</a> 
    </nav>
  </div>

  <div class="header-icons">
    <div id="clockBtn">
      <i class="fa-regular fa-clock"></i>
      <span id="clockText">--:-- PM</span>
    </div>
    <i class="header-icon fa-solid fa-comment-dots" id="commentIcon" title="Feedback"></i>
    <i class="header-icon fa-solid fa-circle-question" id="helpIcon" title="Get Help"></i>
  </div>
</header>


<div class="main">
  <div class="message-box">
    <div class="welcome-section">
  <div class="welcome-content">
    <h1>EBS Response</h1>
    <p>Select the concern and type to generate the correct response template.</p>
  </div>
</div>

<!-- CAUTION/REMINDER BANNER -->
<div class="caution-banner">
<div class="caution-icon">
<i class="fa-solid fa-triangle-exclamation"></i>
</div>
<div class="caution-content">
<h3>⚠️ Important Reminder</h3>
<p><strong>Avoid sending duplicate responses on reopened cases.</strong> In our client business review, we found cases where customers reopened and agents sent the same previous response.</p>
<ul>
<li><strong>Reword responses</strong> each time and provide additional details when possible</li>
<li><strong>If customer continues to reject your decision:</strong> Consult your Team Lead or Training Team</li>
<li><strong>Suggested response while escalating:</strong> "We completely understand where you are coming from. Let me discuss this with our management team to explore the best possible options to assist you."</li>
</ul>
</div>
</div>


    <div class="select-row">
      <select id="concernSelect">
        <option value="">Select Concern</option>
      </select>

      <select id="typeSelect" disabled>
        <option value="">Select Type</option>
      </select>
    </div>
    
    <div style="margin-bottom:12px;">
  <strong>Description</strong>
  <div id="descBox" style="margin-top:6px; padding:10px; background:#f8fafc; border-left:4px solid #4d148c; border-radius:6px; color:#334155;"></div>
</div>

    <label><strong>Response Template</strong></label>
    <textarea id="responseBox" readonly></textarea>

  <div style="display:flex; gap:10px; margin-top:10px; flex-wrap:wrap;">
  <button class="btn" onclick="copyResponse()">✨ Copy Response</button>
  <a id="outlookLink" class="btn" target="_blank">✉️ Open in Outlook</a>
</div>

    <div id="noteBox" class="note-box" style="display:none;"></div>
  </div>
</div>

<footer>© 2025 EBS Operations</footer>

<!-- HELP MODAL -->
<div id="helpModal" class="modal">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header">
      Get Help <span class="modal-close" onclick="closeHelp()">×</span>
    </div>
    <p>Use this tool to search queues, concerns, and actions. Click the clock for time/calendar and the comment icon to provide feedback.</p>
  </div>
</div>

<!-- COMMENT MODALS -->
<div id="commentModal" class="modal">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header">
      How do you rate the tool? <span class="modal-close" onclick="closeComment()">×</span>
    </div>
    <div class="rating-container">
      <i class="fa-solid fa-star rating-star" data-value="1"></i>
      <i class="fa-solid fa-star rating-star" data-value="2"></i>
      <i class="fa-solid fa-star rating-star" data-value="3"></i>
      <i class="fa-solid fa-star rating-star" data-value="4"></i>
      <i class="fa-solid fa-star rating-star" data-value="5"></i>
    </div>
    <input type="text" id="commentName" placeholder="Your Name (optional)">
    <textarea id="commentText" placeholder="Enter your comment..."></textarea>
    <div class="comment-modal-footer">
      <button class="btn" onclick="sendComment()">Send</button>
      <span class="link-text" onclick="showAllComments()">View all comments & ratings</span>
    </div>
  </div>
</div>

<div id="allCommentsModal" class="modal">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header">
      All Ratings & Comments <span class="modal-close" onclick="closeAllComments()">×</span>
    </div>
    <div id="commentsList"></div>
  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>




let DATA = [];

function showToast(msg="Copied!") {
  const toast = document.getElementById("toast");
  toast.textContent = msg;
  toast.style.opacity = "1";
  toast.style.transform = "translateY(0)";
  setTimeout(() => {
    toast.style.opacity = "0";
    toast.style.transform = "translateY(10px)";
  }, 1400);
}

function stripWrappingQuotes(text) {
  if (!text) return "";
  if (
    (text.startsWith('"') && text.endsWith('"')) ||
    (text.startsWith("“") && text.endsWith("”"))
  ) {
    return text.slice(1, -1);
  }
  return text;
}

function normalizeRows(rows) {
  let lastConcern = "";
  let lastDesc = "";

  return rows.map(r => {
    r.Concern = (r.Concern || "").trim();
    r.Description = (r.Description || "").trim();
    r.Type = (r.Type || "").trim();
    r["Response Template"] = r["Response Template"] || "";
    r.Note = (r.Note || "").trim();

    if (r.Concern) lastConcern = r.Concern;
    else r.Concern = lastConcern;

    if (r.Description) lastDesc = r.Description;
    else r.Description = lastDesc;

    return r;
  });
}

fetch("ebs-response.ods")
  .then(res => res.arrayBuffer())
  .then(buf => {
    const wb = XLSX.read(buf, { type: "array" });
    const sheet = wb.Sheets[wb.SheetNames[0]];

    const raw = XLSX.utils.sheet_to_json(sheet, {
      defval: "",
      header: ["Concern", "Description", "Type", "Response Template", "Note"],
      range: 1
    });

    DATA = normalizeRows(raw);

    const concerns = [...new Set(DATA.map(r => r.Concern).filter(Boolean))].sort();
    const concernSelect = document.getElementById("concernSelect");

    concernSelect.innerHTML = `<option value="">Select Concern</option>`;
    concerns.forEach(c => {
      const opt = document.createElement("option");
      opt.value = c;
      opt.textContent = c;
      concernSelect.appendChild(opt);
    });
  })
  .catch(err => {
    console.error(err);
    alert("Failed to load ebs-response.ods");
  });

document.getElementById("concernSelect").addEventListener("change", function () {
  const concern = this.value;
  const typeSelect = document.getElementById("typeSelect");
  const responseBox = document.getElementById("responseBox");
  const noteBox = document.getElementById("noteBox");
  const descBox = document.getElementById("descBox");

  typeSelect.innerHTML = `<option value="">Select Type</option>`;
  responseBox.value = "";
  noteBox.style.display = "none";
  descBox.textContent = "";

  if (!concern) {
    typeSelect.disabled = true;
    updateEmailLinks();
    return;
  }

  const rows = DATA.filter(r => r.Concern === concern);
  descBox.textContent = rows[0]?.Description || "";

  const types = [...new Set(rows.map(r => r.Type).filter(Boolean))].sort();
  types.forEach(t => {
    const opt = document.createElement("option");
    opt.value = t;
    opt.textContent = t;
    typeSelect.appendChild(opt);
  });

  typeSelect.disabled = false;
  updateEmailLinks();
});

document.getElementById("typeSelect").addEventListener("change", function () {
  const concern = document.getElementById("concernSelect").value;
  const type = this.value;

  const match = DATA.find(r => r.Concern === concern && r.Type === type);
  if (!match) return;

  const template = stripWrappingQuotes(match["Response Template"] || "");
  const formatted = formatEmailSpacing(template);

  document.getElementById("responseBox").value = formatted;

  const noteBox = document.getElementById("noteBox");
  if (match.Note) {
    noteBox.style.display = "block";
    noteBox.textContent = "Note: " + match.Note;
  } else {
    noteBox.style.display = "none";
  }

  updateEmailLinks();
});

function copyResponse() {
  const text = document.getElementById("responseBox").value;
  if (!text) return;
  navigator.clipboard.writeText(text).then(() => showToast("Response copied!"));
}

function updateEmailLinks() {
  const concern = document.getElementById("concernSelect").value || "EBS Response";
  const type = document.getElementById("typeSelect").value || "";
  const body = document.getElementById("responseBox").value || "";

  const subject = encodeURIComponent(`${concern}${type ? " — " + type : ""}`);
  const encodedBody = encodeURIComponent(body);

  const gmail = `https://mail.google.com/mail/?view=cm&fs=1&su=${subject}&body=${encodedBody}`;
  const outlook = `https://outlook.office.com/mail/deeplink/compose?subject=${subject}&body=${encodedBody}`;

  document.getElementById("gmailLink").href = gmail;
  document.getElementById("outlookLink").href = outlook;
}
</script>
<script>
function formatEmailSpacing(text) {
  if (!text) return "";
  // Normalize line endings
  let t = text.replace(/\r\n/g, "\n");

  // If there are single line breaks between paragraphs, expand them to double breaks
  // This makes emails look like your ODS formatting (spaced paragraphs)
  t = t.replace(/\n{2,}/g, "\n\n");      // collapse crazy spacing to 2
  t = t.replace(/([^\n])\n([^\n])/g, "$1\n\n$2"); // ensure blank line between paragraphs

  return t;
}
</script>
<script>
// wait until DOM is fully loaded
document.addEventListener("DOMContentLoaded", function() {

  // ---------- CLOCK ----------
  const clockBtn = document.getElementById("clockBtn");
  const clockText = document.getElementById("clockText");
  const timeCalendarPopup = document.getElementById("timeCalendarPopup");
  const fullTimeDisplay = document.getElementById("fullTimeDisplay");

  function updateClock() {
    const now = new Date(new Date().toLocaleString("en-PH", { timeZone: "Asia/Manila" }));
    if(clockText) clockText.textContent = now.toLocaleTimeString('en-PH',{hour:'2-digit',minute:'2-digit',hour12:true});
    if(fullTimeDisplay) fullTimeDisplay.textContent = now.toLocaleString('en-PH',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true, month:'short', day:'numeric', year:'numeric'});
  }

  updateClock();
  setInterval(updateClock, 1000);

  // ---------- CALENDAR ----------
  let currentMonth = new Date().getMonth();
  let currentYear = new Date().getFullYear();
  const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];

  function renderCalendar(y, m){
    const grid = document.querySelector("#calendarGrid");
    if(!grid) return;
    grid.innerHTML="";
    document.querySelector("#monthYear").textContent = `${monthNames[m]} ${y}`;

    ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(d=>{
      const el = document.createElement("div");
      el.className="day-name";
      el.textContent=d;
      grid.appendChild(el);
    });

    const firstDay = new Date(y,m,1).getDay();
    for(let i=0;i<firstDay;i++) grid.appendChild(document.createElement("div"));

    const daysInMonth = new Date(y,m+1,0).getDate();
    const today = new Date(new Date().toLocaleString("en-PH",{timeZone:"Asia/Manila"}));
    for(let d=1; d<=daysInMonth; d++){
      const cell = document.createElement("div");
      cell.className="day";
      cell.textContent = d;
      if(d===today.getDate() && m===today.getMonth() && y===today.getFullYear()) cell.classList.add("today");
      grid.appendChild(cell);
    }
  }

  if(document.querySelector("#prevMonth"))
    document.querySelector("#prevMonth").onclick = () => {
      currentMonth--;
      if(currentMonth<0){ currentMonth=11; currentYear--; }
      renderCalendar(currentYear, currentMonth);
    }

  if(document.querySelector("#nextMonth"))
    document.querySelector("#nextMonth").onclick = () => {
      currentMonth++;
      if(currentMonth>11){ currentMonth=0; currentYear++; }
      renderCalendar(currentYear, currentMonth);
    }

  if(clockBtn){
    clockBtn.onclick = (e)=>{
      if(timeCalendarPopup){
        timeCalendarPopup.style.display = timeCalendarPopup.style.display==="block" ? "none":"block";
        renderCalendar(currentYear, currentMonth);
        e.stopPropagation();
      }
    }
  }

  document.addEventListener("click", function(event){
    if(timeCalendarPopup && clockBtn){
      if(timeCalendarPopup.style.display==="block" && !timeCalendarPopup.contains(event.target) && !clockBtn.contains(event.target)){
        timeCalendarPopup.style.display="none";
      }
    }
  });

  // ---------- HELP MODAL ----------
  const helpModal = document.getElementById("helpModal");
  const commentModal = document.getElementById("commentModal");
  const allCommentsModal = document.getElementById("allCommentsModal");

  document.getElementById("helpIcon")?.addEventListener("click", ()=>{ if(helpModal) helpModal.style.display="flex"; });
  document.getElementById("commentIcon")?.addEventListener("click", ()=>{ if(commentModal) commentModal.style.display="flex"; });

  window.closeHelp = function(){ if(helpModal) helpModal.style.display="none"; }
  window.closeComment = function(){ if(commentModal) commentModal.style.display="none"; }
  window.closeAllComments = function(){ if(allCommentsModal) allCommentsModal.style.display="none"; }

  // prevent modal clicks from closing
  [helpModal, commentModal, allCommentsModal].forEach(modal=>{
    if(modal){
      modal.addEventListener("click", ()=>{ modal.style.display="none"; });
      modal.querySelector(".modal-content")?.addEventListener("click", e=>e.stopPropagation());
    }
  });

  // ---------- FIREBASE ----------
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_STORAGE_BUCKET",
    messagingSenderId: "YOUR_MSG_ID",
    appId: "YOUR_APP_ID"
  };

  if(firebase?.initializeApp){
    firebase.initializeApp(firebaseConfig);
    window.db = firebase.firestore();
  }

});
</script>


</body>
</html>

