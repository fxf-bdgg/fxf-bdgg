<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BD Tools â€” EBS Response Template</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
:root{
  --bg:#f4f7fb; --accent:#4d148c; --accent-dark:#3a0f6b; --muted:#64748b; font-family: Inter, ui-sans-serif, system-ui;
}
body{margin:0; background:var(--bg); display:flex; flex-direction:column; min-height:100vh;}
header{background:var(--accent); color:white; padding:16px 28px; display:flex; align-items:center;}
header img{height:40px;}
.nav-tabs{display:flex; gap:30px; margin-left:20px;}
.tab{color:white; text-decoration:none; font-weight:600; font-size:16px;}
.tab.active{border-bottom:3px solid #ff6600;}
.main{flex:1; padding:40px; display:flex; justify-content:center;}
.message-box{background:white; padding:40px; border-radius:14px; width:100%; max-width:1200px;}
.control-group{display:flex; gap:20px; flex-wrap:wrap; margin:20px 0;}
select{padding:10px; border-radius:6px; border:1px solid #ccc; min-width:200px; cursor:pointer;}
.response-container{margin-top:30px;}
.response-item{background:#f8fafc; border:1px solid #e2e8f0; border-radius:10px; padding:20px; margin-bottom:20px;}
.expandable-header{cursor:pointer; font-weight:600; color:var(--accent);}
.expandable-content{display:none; padding:10px 0;}
.response-text{background:white; padding:16px; border-left:4px solid var(--accent); white-space:pre-wrap;}
.copy-btn{background:var(--accent); color:white; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; margin-top:12px;}
.copy-btn:hover{background:var(--accent-dark);}
</style>
</head>
<body>

<header>
  <a href="#"><img src="fedex.png" alt="FedEx Logo"></a>
  <nav class="nav-tabs">
    <a href="#" class="tab">Home</a>
    <a href="#" class="tab">Case Directory</a>
    <a href="#" class="tab active">EBS Response</a>
  </nav>
</header>

<div class="main">
  <div class="message-box">
    <h1 style="color:#4d148c;">EBS Response Template</h1>

    <div class="control-group">
      <label for="concernSelect">Concern:</label>
      <select id="concernSelect"><option value="">-- Select Concern --</option></select>

      <label for="typeSelect">Type:</label>
      <select id="typeSelect" disabled><option value="">-- Select Type --</option></select>
    </div>

    <div class="response-container" id="responseContainer"></div>
  </div>
</div>

<footer style="background:var(--accent); color:white; text-align:center; padding:16px;">Â© 2025 EBS Operations</footer>

<script>
function copyToClipboard(btn){
  const text = btn.previousElementSibling.textContent;
  navigator.clipboard.writeText(text);
  btn.textContent = "âœ“ Copied!";
  setTimeout(()=>{btn.textContent="ðŸ“‹ Copy Template";},2000);
}

// Expand/collapse
function toggleExpand(el){
  const content = el.nextElementSibling;
  content.style.display = content.style.display==='block'?'none':'block';
}

// Populate dropdowns
function populateConcernDropdown(){
  const concerns = [...new Set(window.TEMPLATES.map(t=>t.Concern).filter(Boolean))].sort();
  const concernSelect = document.getElementById('concernSelect');
  concerns.forEach(c=>{
    const opt = document.createElement('option'); opt.value=c; opt.textContent=c;
    concernSelect.appendChild(opt);
  });
}

function populateTypeDropdown(concern){
  const typeSelect = document.getElementById('typeSelect');
  typeSelect.innerHTML = '<option value="">-- All Types --</option>';
  const types = [...new Set(window.TEMPLATES.filter(t=>t.Concern===concern).map(t=>t.Type).filter(Boolean))];
  types.forEach(t=>{
    const opt = document.createElement('option'); opt.value=t; opt.textContent=t;
    typeSelect.appendChild(opt);
  });
  typeSelect.disabled = types.length===0;
}

// Display templates
function displayTemplates(concern, type=""){
  const container = document.getElementById('responseContainer');
  container.innerHTML = "";
  let templates = window.TEMPLATES.filter(t=>t.Concern===concern);
  if(type) templates = templates.filter(t=>t.Type===type);
  if(templates.length===0){ container.innerHTML="<p>No templates found.</p>"; return; }
  templates.forEach(t=>{
    const div = document.createElement('div'); div.className='response-item';
    div.innerHTML = `
      <div class="expandable-header" onclick="toggleExpand(this)">${t.Type}</div>
      <div class="expandable-content">
        <div><strong>Concern:</strong> ${t.Concern}</div>
        <div><strong>Type:</strong> ${t.Type}</div>
      </div>
      <div class="response-text">${t['Response Template']}</div>
      <button class="copy-btn" onclick="copyToClipboard(this)">ðŸ“‹ Copy Template</button>
    `;
    container.appendChild(div);
  });
}

// Event listeners
document.getElementById('concernSelect').addEventListener('change', e=>{
  const concern = e.target.value;
  populateTypeDropdown(concern);
  displayTemplates(concern);
});

document.getElementById('typeSelect').addEventListener('change', e=>{
  const concern = document.getElementById('concernSelect').value;
  displayTemplates(concern, e.target.value);
});

// Load ODS/CSV
fetch("ebs-response.ods")
.then(res=>res.arrayBuffer())
.then(data=>{
  const wb = XLSX.read(data,{type:'array'});
  const sheet = wb.Sheets[wb.SheetNames[0]];
  window.TEMPLATES = XLSX.utils.sheet_to_json(sheet,{defval:""});
  populateConcernDropdown();
})
.catch(err=>console.error(err));
</script>

</body>
</html>
