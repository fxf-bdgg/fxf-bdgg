<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BD Tools — Case Directory</title>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<!-- PapaParse for CSV -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

<style>
:root{
  --bg:#f4f7fb;
  --card:#ffffff;
  --muted:#64748b;
  --accent:#4d148c;
  --accent-dark:#3a0f6b;
  font-family: Inter, ui-sans-serif, system-ui;
}

*{box-sizing:border-box;}
body{
  margin:0;
  background:linear-gradient(180deg,var(--bg),#eef6ff);
  display:flex;
  flex-direction:column;
  min-height:100vh;
}

/* ---------- HEADER ---------- */
header{
  background:var(--accent);
  color:white;
  padding:16px 28px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  position:relative;
  overflow:hidden;
  z-index:1;
}
header img{height:40px; animation:logoFlyIn 1s ease-out forwards; opacity:0;}
.nav-tabs{display:flex; gap:30px;}
.tab{color:white; text-decoration:none; font-weight:600; font-size:16px; position:relative; padding:6px 0; transition: opacity 0.2s;}
.tab:hover{opacity:0.8;}
.tab.active::after{content:"";position:absolute;left:0;bottom:-6px;width:100%;height:3px;background:#ff6600;border-radius:3px;}

.header-icons{display:flex;align-items:center;gap:20px;}
#clockBtn{cursor:pointer; display:flex; align-items:center; gap:6px; font-size:18px; font-weight:600; color:white; position:relative;}
#clockBtn:hover{transform:scale(1.1);}
.header-icon{font-size:24px;color:white;cursor:pointer;transition:color .2s,transform .2s;}
.header-icon:hover{transform:scale(1.3);}
.header-icon.active{color:var(--accent-dark);}

/* ---------- HEADER ANIMATIONS ---------- */
@keyframes logoFlyIn {0%{opacity:0;transform:translateX(-50px) scale(0.8);}100%{opacity:1;transform:translateX(0) scale(1);}}
header::after{
  content:"";
  position:absolute; top:0; left:-100%;
  width:100%; height:100%;
  background: linear-gradient(120deg, #4d148c, #ff6600, #4d148c);
  transform:skewX(-20deg);
  animation:sweep 1s ease-out forwards;
  z-index:0;
  opacity:0.2;
}
@keyframes sweep{0%{left:-100%;}100%{left:100%;}}

/* ---------- MAIN ---------- */
.main{
  flex:1;
  padding:40px;
  display:flex;
  justify-content:center;
}
.message-box{
  background:white;
  padding:40px;
  border-radius:14px;
  box-shadow:0 10px 30px rgba(0,0,0,0.08);
  width:100%;
  max-width:1800px; /* match main menu shell */
}
input{
  width:100%;
  padding:12px 14px;
  border-radius:8px;
  border:1px solid #e2e8f0;
  font-size:15px;
  margin:20px 0;
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}
th, td{padding:12px; vertical-align:top;}
th{background:#f1f5f9; position:sticky; top:0;}
table th:nth-child(1){ width:20%; }
table th:nth-child(2){ width:25%; }
table th:nth-child(3){ width:20%; }
table th:nth-child(4){ width:15%; }
table th:nth-child(5){ width:20%; }
pre{
  background:#f8fafc;
  padding:10px;
  border-radius:6px;
  white-space:pre-wrap;
  margin:0;
}
tbody td:first-child { font-weight:700; }
tbody tr {border-bottom:2px solid #e2e8f0; opacity:0; animation:rowFadeIn 0.5s ease forwards;}
tbody tr:nth-child(odd){background-color:#fcfcfc;}
tbody tr:nth-child(even){background-color:#ffffff;}
td{padding:16px 12px;}
@keyframes rowFadeIn{0%{opacity:0;transform:translateY(10px);}100%{opacity:1;transform:translateY(0);}}

footer{
  background:var(--accent);
  color:white;
  padding:16px;
  text-align:center;
}

/* ---------- POPUPS ---------- */
.modal {display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); justify-content:center; align-items:center; padding:20px; z-index:1000;}
.modal-content{background:white; border-radius:10px; padding:24px; width:100%; max-width:500px; box-shadow:0 10px 30px rgba(0,0,0,0.2);}
.modal-header{display:flex; justify-content:space-between; align-items:center; font-size:20px; font-weight:700; margin-bottom:12px;}
.modal-close{font-size:22px; cursor:pointer; color:var(--muted);}
.modal-close:hover{color:var(--accent);}

.comment-modal-footer{display:flex; justify-content:space-between; align-items:center; margin-top:12px;}
.link-text{color:var(--accent-dark); cursor:pointer; text-decoration:underline; font-size:14px; display:block; margin-top:10px;}

#timeCalendarPopup{display:none; position:absolute; top:60px; right:20px; background:white; border-radius:8px; box-shadow:0 8px 24px rgba(0,0,0,0.25); padding:16px; width:310px; z-index:900;}
#timeCalendarPopup h3{margin:0;text-align:center;font-size:18px;color:var(--accent-dark); margin-bottom:8px;}
.calendar-header{display:flex; justify-content:space-between; align-items:center; background:#f0f0f0; padding:8px; border-radius:6px;}
.calendar-header span{cursor:pointer;color:var(--accent-dark); font-weight:600;}
.calendar-title{font-weight:700;}
.calendar-grid{display:grid; grid-template-columns:repeat(7,1fr); gap:4px; margin-top:8px;}
.calendar-grid .day-name{text-align:center;font-size:12px;font-weight:700;color:var(--muted);}
.calendar-grid .day{text-align:center;padding:8px 0;font-size:14px;border-radius:50%;}
.calendar-grid .today{background:var(--accent);color:white;font-weight:700;}
.calendar-grid .day:hover{background:#f0f0f0;}
</style>
</head>
<body>

<header>
  <div style="display:flex;align-items:center;gap:40px;">
    <a href="index.html">
  <img src="fedex.png" alt="FedEx Logo" style="height:40px;">
</a>
    <nav class="nav-tabs">
      <a href="index.html" class="tab">Home</a>
      <a href="case-directory.html" class="tab active">Case Directory</a>
      <a href="ebs-response-template.html" class="tab active">EBS Response</a>
    </nav>
  </div>

  <div class="header-icons">
    <div id="clockBtn">
      <i class="fa-regular fa-clock"></i>
      <span id="clockText">--:-- PM</span>
    </div>
    <i class="header-icon fa-solid fa-comment-dots" id="commentIcon" title="Feedback"></i>
    <i class="header-icon fa-solid fa-circle-question" id="helpIcon" title="Get Help"></i>
  </div>
</header>

<div id="timeCalendarPopup">
  <h3 id="fullTimeDisplay">--:--:-- — --/--/----</h3>
  <div class="calendar-header">
    <span id="prevMonth">&lt;</span>
    <span class="calendar-title" id="monthYear"></span>
    <span id="nextMonth">&gt;</span>
  </div>
  <div class="calendar-grid" id="calendarGrid"></div>
</div>

<div class="main">
  <div class="message-box">
    <h1 style="color:#4d148c;">Case Directory</h1>
    <p>Search for the correct department or queue to move the case.</p>

    <input id="searchBox" placeholder="Search queue, concern, action, email, assignment...">

    <div style="max-height:520px; overflow:auto; border:1px solid #eef2f7; border-radius:10px;">
      <table>
        <thead>
          <tr>
            <th>QUEUE / Request</th>
            <th>Concern</th>
            <th>ACTION</th>
            <th>Email Address</th>
            <th>Case Assignment / Email</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </div>
  </div>
</div>

<footer>© 2025 EBS Operations</footer>

<!-- HELP MODAL -->
<div id="helpModal" class="modal">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header">
      Get Help <span class="modal-close" onclick="closeHelp()">×</span>
    </div>
    <p>Use this tool to search queues, concerns, and actions. Click the clock for time/calendar and the comment icon to provide feedback.</p>
  </div>
</div>

<!-- COMMENT MODALS -->
<div id="commentModal" class="modal">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header">
      How do you rate the tool? <span class="modal-close" onclick="closeComment()">×</span>
    </div>
    <div class="rating-container">
      <i class="fa-solid fa-star rating-star" data-value="1"></i>
      <i class="fa-solid fa-star rating-star" data-value="2"></i>
      <i class="fa-solid fa-star rating-star" data-value="3"></i>
      <i class="fa-solid fa-star rating-star" data-value="4"></i>
      <i class="fa-solid fa-star rating-star" data-value="5"></i>
    </div>
    <input type="text" id="commentName" placeholder="Your Name (optional)">
    <textarea id="commentText" placeholder="Enter your comment..."></textarea>
    <div class="comment-modal-footer">
      <button class="btn" onclick="sendComment()">Send</button>
      <span class="link-text" onclick="showAllComments()">View all comments & ratings</span>
    </div>
  </div>
</div>

<div id="allCommentsModal" class="modal">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header">
      All Ratings & Comments <span class="modal-close" onclick="closeAllComments()">×</span>
    </div>
    <div id="commentsList"></div>
  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
// FIREBASE INIT
const firebaseConfig = {
  apiKey: "AIzaSyDjaMdeh0Cgx00hzDyZOi54fDkR81wnxJU",
  authDomain: "bdgg-database.firebaseapp.com",
  projectId: "bdgg-database",
  storageBucket: "bdgg-database.appspot.com",
  messagingSenderId: "43574975434",
  appId: "1:43574975434:web:4c79e581267fdfcc6ccd33"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ---------- PHILIPPINE TIME ----------
function getPhilippineNow(){return new Date(new Date().toLocaleString("en-PH",{timeZone:"Asia/Manila"}));}

// CLOCK
function updateHeaderClock(){
  const now=getPhilippineNow();
  document.getElementById('clockText').textContent = now.toLocaleTimeString('en-PH',{hour:'2-digit',minute:'2-digit',hour12:true,timeZone:'Asia/Manila'});
  document.getElementById('fullTimeDisplay').textContent = now.toLocaleString('en-PH',{hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:true,month:'short',day:'numeric',year:'numeric',timeZone:'Asia/Manila'});
}
setInterval(updateHeaderClock,1000); updateHeaderClock();

// CALENDAR
let currentMonth=getPhilippineNow().getMonth();
let currentYear=getPhilippineNow().getFullYear();
const monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"];
function renderCalendar(y,m){
  const grid=document.getElementById('calendarGrid');
  grid.innerHTML="";
  document.getElementById('monthYear').textContent=`${monthNames[m]} ${y}`;
  ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].forEach(d=>{const e=document.createElement('div'); e.className="day-name"; e.textContent=d; grid.appendChild(e);});
  const firstDay=new Date(y,m,1).getDay();
  for(let i=0;i<firstDay;i++) grid.appendChild(document.createElement('div'));
  const daysInMonth=new Date(y,m+1,0).getDate();
  const todayPHT=getPhilippineNow();
  for(let d=1;d<=daysInMonth;d++){
    const cell=document.createElement('div'); cell.className="day"; cell.textContent=d;
    if(d===todayPHT.getDate() && m===todayPHT.getMonth() && y===todayPHT.getFullYear()) cell.classList.add('today');
    grid.appendChild(cell);
  }
}
document.getElementById('prevMonth').onclick=()=>{currentMonth--; if(currentMonth<0){currentMonth=11; currentYear--;} renderCalendar(currentYear,currentMonth);}
document.getElementById('nextMonth').onclick=()=>{currentMonth++; if(currentMonth>11){currentMonth=0; currentYear++;} renderCalendar(currentYear,currentMonth);}
document.getElementById('clockBtn').onclick=function(e){const popup=document.getElementById('timeCalendarPopup'); popup.style.display=popup.style.display==='block'?'none':'block'; renderCalendar(currentYear,currentMonth); e.stopPropagation();}
document.addEventListener('click', function(event){const popup=document.getElementById('timeCalendarPopup'); const btn=document.getElementById('clockBtn'); if(popup.style.display==='block'&&!popup.contains(event.target)&&!btn.contains(event.target)){popup.style.display='none';}});

// HELP
document.getElementById('helpIcon').onclick=(e)=>{document.getElementById('helpModal').style.display='flex'; e.stopPropagation();};
function closeHelp(){document.getElementById('helpModal').style.display='none';}

// FEEDBACK
let selectedRating=0;
document.querySelectorAll('.rating-star').forEach(star=>{star.onclick=function(ev){selectedRating=parseInt(this.dataset.value); document.querySelectorAll('.rating-star').forEach(s=>s.classList.toggle('selected',parseInt(s.dataset.value)<=selectedRating)); ev.stopPropagation();};});
function sendComment(){const name=document.getElementById('commentName').value.trim(); const comment=document.getElementById('commentText').value.trim(); if(selectedRating===0){alert("Select a rating."); return;} db.collection("feedback").add({rating:selectedRating,name:name||"Anonymous",comment:comment,createdAt: firebase.firestore.FieldValue.serverTimestamp()}).then(()=>{alert("Saved!"); clearCommentForm();}).catch(()=>alert("Save failed."));}
function clearCommentForm(){selectedRating=0; document.getElementById('commentName').value=""; document.getElementById('commentText').value=""; document.querySelectorAll('.rating-star').forEach(s=>s.classList.remove('selected'));}
let unsubscribeListener=null;
function showAllComments(){const listEl=document.getElementById('commentsList'); listEl.innerHTML="Loading…"; if(unsubscribeListener) unsubscribeListener(); unsubscribeListener=db.collection("feedback").orderBy("createdAt","desc").onSnapshot(snap=>{ listEl.innerHTML=""; if(snap.empty){ listEl.innerHTML="<p>No feedback yet.</p>";} snap.forEach(doc=>{const d=doc.data(); const div=document.createElement('div'); div.className="comment-list-item"; div.innerHTML=`<div class="stars">${"★".repeat(d.rating)}${"☆".repeat(5-d.rating)}</div><strong>${d.name}</strong><p>${d.comment}</p>`; listEl.appendChild(div);}); document.getElementById('allCommentsModal').style.display='flex';});}
document.getElementById('commentIcon').onclick=function(e){clearCommentForm(); document.getElementById('commentModal').style.display='flex'; e.stopPropagation();};
function closeComment(){clearCommentForm();document.getElementById('commentModal').style.display='none';}
function closeAllComments(){document.getElementById('allCommentsModal').style.display='none';}

// ---------- CSV TABLE ----------
function renderTable(CASES, highlight="") {
  const rowsEl=document.getElementById("rows");
  const regex=new RegExp(`(${highlight.replace(/[-/\\^$*+?.()|[\]{}]/g,'\\$&')})`,"gi");
  rowsEl.innerHTML=CASES.map(r=>{
    return `<tr>
      <td>${highlight?r['QUEUE/ Request'].replace(regex,'<mark>$1</mark>'):r['QUEUE/ Request']}</td>
      <td style="white-space:pre-line">${highlight?r['Concern'].replace(regex,'<mark>$1</mark>'):r['Concern']}</td>
      <td style="white-space:pre-line">${highlight?r['ACTION'].replace(regex,'<mark>$1</mark>'):r['ACTION']}</td>
      <td>${highlight?r['Email Address'].replace(regex,'<mark>$1</mark>'):r['Email Address']}</td>
      <td><pre>${highlight?r['Case Assignment/Email'].replace(regex,'<mark>$1</mark>'):r['Case Assignment/Email']}</pre></td>
    </tr>`;
  }).join("");
}

// Load CSV
Papa.parse("case-directory.csv", {
  download:true,
  header:true,
  skipEmptyLines:true,
  complete:function(results){
    window.CASES=results.data;
    renderTable(window.CASES);
    document.getElementById("searchBox").addEventListener("input", e=>{
      const query=e.target.value.toLowerCase().trim();
      if(!query){ renderTable(window.CASES); return; }
      const startsWithQueue=[], includesQueue=[], otherMatches=[];
      window.CASES.forEach(r=>{
        const queue=(r['QUEUE/ Request']||"").toLowerCase().trim();
        const concern=(r['Concern']||"").toLowerCase().trim();
        const action=(r['ACTION']||"").toLowerCase().trim();
        const email=(r['Email Address']||"").toLowerCase().trim();
        const assignment=(r['Case Assignment/Email']||"").toLowerCase().trim();
        if(queue.startsWith(query)) startsWithQueue.push(r);
        else if(queue.includes(query)) includesQueue.push(r);
        else if(concern.includes(query)||action.includes(query)||email.includes(query)||assignment.includes(query)) otherMatches.push(r);
      });
      const filtered=[...startsWithQueue,...includesQueue,...otherMatches];
      renderTable(filtered, query);
    });
  }
});
</script>

</body>
</html>



